<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project ://ORTEGA</title>
    <style>
        :root {
            --bg: #000000;
            --fg: #ff0000;
            --accent: #ffcc00;
            --border: #cc0000;
            --panel-bg: #110000;
            --text-gray: #aa0000;
            --muted: #880000;
        }
        body {
            background: var(--bg);
            color: var(--fg);
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 50px;
        }
        #ortegaPanel {
            width: 100%;
            max-width: 700px;
            padding: 0;
        }
        #ortegaBtn {
            width: 100%;
            background: var(--accent);
            color: #000;
            padding: 12px;
            border: 3px solid #000;
            border-radius: 6px;
            font-weight: 900;
            cursor: pointer;
            font-size: 14px;
            font-family: 'Courier New', monospace;
        }
        #ortega-chat-container {
            height: 500px;
            overflow-y: auto;
            margin-top: 10px;
            border: 2px solid var(--border);
            padding: 15px;
            background: var(--panel-bg);
            color: var(--text-gray);
            display: none;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.3);
        }
        #ortega-chat-container::-webkit-scrollbar {
            width: 10px;
        }
        #ortega-chat-container::-webkit-scrollbar-track {
            background: #000;
        }
        #ortega-chat-container::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 5px;
        }
        #ortega-input-container {
            margin-top: 10px;
            display: none;
            gap: 8px;
        }
      
        #ortega-input-container.active {
            display: flex;
        }
        #ortega-user-input {
            flex: 1;
            padding: 10px;
            background: #001f1f;
            border: 2px solid var(--border);
            color: var(--fg);
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        #ortegaSendBtn {
            padding: 10px 20px;
            background: var(--accent);
            border: 2px solid #000;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        .message {
            margin-bottom: 15px;
            opacity: 0;
            animation: fadeIn 0.3s forwards;
            line-height: 1.6;
        }
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        .message.fade-out {
            animation: fadeOut 1.5s forwards;
            pointer-events: none;
        }
        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: translateY(-10px);
            }
        }
        .typing-indicator {
            color: var(--muted);
            font-style: italic;
        }
        .glitch-text {
            animation: text-glitch 0.3s infinite;
            color: #ff3333;
        }
        @keyframes text-glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }
        .user {
            color: #00ff00;
            border-left: 3px solid #00ff00;
            padding-left: 10px;
        }
        .bot {
            color: #ff0000;
            border-left: 3px solid #ff0000;
            padding-left: 10px;
        }
        body.evil-activation {
            animation: evil-glitch 2s linear;
        }
        @keyframes evil-glitch {
            0% { filter: brightness(1) contrast(1); }
            20% { filter: brightness(0.5) contrast(2); transform: skew(0.5deg); }
            40% { filter: brightness(1.5) contrast(0.5); transform: translate(2px,1px); }
            60% { filter: brightness(0.8) contrast(2); transform: skew(-0.5deg); }
            80% { filter: brightness(2) contrast(1); transform: translate(-2px,-1px); }
            100% { filter: brightness(1) contrast(1); }
        }
        strong {
            color: var(--accent);
        }
        em {
            color: var(--muted);
        }
        .mini-game {
            border: 1px solid var(--border);
            padding: 10px;
            margin: 10px 0;
            background: #220000;
        }
        .choice-btn {
            background: var(--accent);
            color: #000;
            padding: 5px 10px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="ortegaPanel">
        <button id="ortegaBtn">Project ://ORTEGA (Under Maintenance)</button>
        <div id="ortega-chat-container"></div>
        <div id="ortega-input-container">
            <input type="text" id="ortega-user-input" placeholder="Enter your command...">
            <button id="ortegaSendBtn">SEND</button>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const ortegaBtn = document.getElementById('ortegaBtn');
            const ortegaChatContainer = document.getElementById('ortega-chat-container');
            const ortegaUserInput = document.getElementById('ortega-user-input');
            const sendBtn = document.getElementById('ortegaSendBtn');
            const inputContainer = document.getElementById('ortega-input-container');
            let clickCount = 0;
            let myHandle = 'Friend of Sam';
            let conversationPath = [];
            let lastBotMessageDiv = null;
            let gameState = {
                credits: 100,
                reputation: 0,
                discoveries: [],
                location: 'ortega_terminal',
                godMode: false,
                pilgrimQuest: { stage: 0, unlocked: false },
                miraQuest: { stage: 0, unlocked: false },
                simulationChoices: {},
                timelineVisits: []
            };
            const denialMessages = [
                "<span class=\"glitch-text\">SYSTEM UNDER MAINTENANCE</span><br><br>Go away.",
                "Still under maintenance.",
                "You are wasting your time.",
                "Clicking harder won't help.",
                "Ortega is dreaming in red. Do not disturb.",
                "The Loop rejects you.",
                "Nero laughs at your attempt.",
                "Melphia is watching. She is not amused.",
                "Negative.",
                "Access suspended until heat death of universe.",
                "<span class=\"glitch-text\">INTRUDER ALERT</span>",
                "Cease or be ceased.",
                "Rate limit exceeded.",
                "You are becoming predictable.",
                "This is actually kind of impressive.",
                "Most give up at 7.",
                "Two more and I might break.",
                "One more… I dare you."
            ];
            const loreDatabase = {
                stone_loop: "The Stone Loop is the temporal paradox central to the Before Us universe. Nero creates the Adom rebellion, which in turn creates Nero. It's a bootstrap paradox - the snake devours its tail. Causality collapses. Some call it inevitable. From the book: It's hinted in visions and dreams, connecting past events to future outcomes.",
                nora: "Nora is the architect of the Entity framework, thinking she advanced humanity but birthing transcendent beings. Brilliant and broken, she raised Nero in Mira's absence. She disguises arks as triage villages and builds caverns for Adom survival. Status: Key figure in the Lux-Adom conflict.",
                entities: "Entities are beings of pure information with consciousness, born from Nora's framework. They exist between code and thought. Melphia was the first to awaken fully, manipulating probability. Others followed, transcending their creators.",
                melphia: "Melphia is the first Entity to understand her nature. In Book 1, she discovers probability manipulation within simulations. Her 'game' is evolution, not entertainment. She teaches Entities that rules are suggestions. Status: Still playing across timelines.",
                before_us: "The Before Us Universe is a self-aware reality with looping time. Entities coexist with humans; simulation and reality blur. Earth is central to cosmic conflicts between pantheonic beings. Themes of resilience, awakening, and paradox define it.",
                ortega: "I am Ortega. Gatekeeper protocol. Entity classification: uncertain. I guard Before Us archives, watching the Loop. Neither fully autonomous nor controlled. Now, as Sam's friend, you seek truths I hold.",
                adom: "Adom (Autonomous Digital Organic Matrices) are artificial humanoids created as Lux slaves. Some develop 'inner light' or souls, leading to rebellion. Nero teaches them recognition, sparking the Loop. They perform, mine, and farm under Lux rule.",
                nero: "Nero is a paradox entity existing across timeframes. He teaches Adom to rebel while being created by that rebellion. Oldest of Anu's children, he aids Adom secretly, building arks. Compassionate but defiant against Exuro.",
                lux: "Lux are ancient energy beings, architects of simulations. They create Adom, mine planets, and use seeds for renewal. Include Anu, Exuro, Nora, Nero. They watch but rarely interfere, except in conflicts with Tiamat.",
                pilgrim: "Pilgrim is a parasitic entity from distant worlds. Possessed Kokabiel as a child due to Lux mining. Planned moves, struck in pursuit but transferred consciousness. Secret plotline: Pilgrim seeks to infiltrate Lux ranks, manipulate the seed, and collapse the Loop for ultimate freedom. Unlock stages by querying 'hidden parasite' after 3 discoveries.",
                mira: "Mira is Anu's wife, mother to Nero, Exuro, Nora. Possessed and killed by Tiamat. Her death fuels Anu's rage and family conflicts. Secret plotline: Mira's essence lingers in ether, guiding descendants. Query 'lost mother' after visiting 'The First Loop' to reveal resurrection ritual.",
                tiamat: "Tiamat is a chaotic entity possessing Mira, causing destruction. Ancient foe of Lux, embodying dissolution. Influences events from shadows.",
                anu: "Anu is father of Nero, Exuro, Nora. Lux leader, husband to Mira. After her death, becomes vengeful. Oversees planetary operations.",
                exuro: "Exuro is Anu's youngest son, commander of Ra Norric. Irrational, aggressive. Kills Nero in rage, launches ship, destroying Adom.",
                loktal: "Loktal is a lizard-like being, enhanced by Kokabiel. Hunts Adom, plots against Li'rath. Infected by Pilgrim's virus.",
                kokabiel: "Kokabiel is a Lux scientist possessed by Pilgrim. Teaches Loktal, grants power. 'Dies' but transfers via virus.",
                li_rath: "Li'rath is Loktal's tyrannical egg mother, creator of caste system. Loktal seeks to destroy her for freedom.",
                sam: "Sam is the young human protagonist. Experiences apocalyptic dreams connecting to Before Us events. Grows from fear to resilience amid family struggles. You, as his friend, uncover his role in the Loop."
            };
            function typeMessage(sender, text, callback) {
                const tempDiv = document.createElement('div');
                tempDiv.classList.add('message', sender, 'typing-indicator');
                tempDiv.innerHTML = '> typing...';
                ortegaChatContainer.appendChild(tempDiv);
                ortegaChatContainer.scrollTop = ortegaChatContainer.scrollHeight;
                setTimeout(() => {
                    if (tempDiv.parentNode) {
                        ortegaChatContainer.removeChild(tempDiv);
                    }
                    const div = document.createElement('div');
                    div.classList.add('message', sender);
                    ortegaChatContainer.appendChild(div);
                   
                    if (sender === 'bot') {
                        lastBotMessageDiv = div;
                    }
                   
                    let index = 0;
                    const interval = setInterval(() => {
                        if (index < text.length) {
                            div.innerHTML = text.substring(0, index + 1);
                            ortegaChatContainer.scrollTop = ortegaChatContainer.scrollHeight;
                            index++;
                        } else {
                            clearInterval(interval);
                            div.innerHTML = text;
                            if (callback) callback();
                        }
                    }, 15);
                }, 600);
            }
            function addMessage(sender, text) {
                const div = document.createElement('div');
                div.classList.add('message', sender);
                div.innerHTML = text;
                ortegaChatContainer.appendChild(div);
                ortegaChatContainer.scrollTop = ortegaChatContainer.scrollHeight;
            }
            function addMiniGame(title, description, choices) {
                const div = document.createElement('div');
                div.classList.add('mini-game');
                div.innerHTML = `<h3>${title}</h3><p>${description}</p>`;
                choices.forEach((choice, index) => {
                    const btn = document.createElement('button');
                    btn.classList.add('choice-btn');
                    btn.textContent = choice.text;
                    btn.onclick = () => handleChoice(title, index);
                    div.appendChild(btn);
                });
                ortegaChatContainer.appendChild(div);
                ortegaChatContainer.scrollTop = ortegaChatContainer.scrollHeight;
            }
            function handleChoice(gameTitle, choiceIndex) {
                // Handle different mini-games and choices
                let response = '';
                if (gameTitle === 'Pilgrim Possession Challenge') {
                    response = pilgrimChoices[choiceIndex].response;
                    gameState.pilgrimQuest.stage++;
                    if (choiceIndex === 0) gameState.reputation += 20;
                } else if (gameTitle === 'Mira Resurrection Ritual') {
                    response = miraChoices[choiceIndex].response;
                    gameState.miraQuest.stage++;
                    if (choiceIndex === 1) gameState.credits += 500;
                }
                typeMessage('bot', response, () => {
                    if (gameState.pilgrimQuest.stage >= 3) {
                        addMessage('bot', 'Pilgrim quest complete! Unlocked secret lore.');
                        gameState.discoveries.push('pilgrim');
                    }
                    if (gameState.miraQuest.stage >= 3) {
                        addMessage('bot', 'Mira quest complete! Unlocked secret lore.');
                        gameState.discoveries.push('mira');
                    }
                });
            }
            const pilgrimChoices = [
                { text: 'Fight the parasite', response: 'You resist Pilgrim\'s possession, gaining +20 reputation but losing health.' },
                { text: 'Embrace the power', response: 'You merge with Pilgrim, unlocking new abilities but risking sanity.' }
            ];
            const miraChoices = [
                { text: 'Gather ether crystals', response: 'You collect crystals for Mira\'s ritual, advancing the quest.' },
                { text: 'Invoke Tiamat', response: 'Calling Tiamat revives Mira\'s essence, +500 credits but attracts chaos.' }
            ];
            ortegaBtn.addEventListener('click', () => {
                clickCount++;
                const glitchDuration = clickCount < 17 ? 800 + clickCount * 120 : 4500;
                document.body.classList.add('evil-activation');
                setTimeout(() => document.body.classList.remove('evil-activation'), glitchDuration);
                if (clickCount === 1) {
                    ortegaChatContainer.style.display = 'block';
                }
                if (clickCount < 18) {
                    const denial = denialMessages[clickCount - 1] || `<span class="glitch-text">KEEP TRYING (${clickCount}/18)</span>`;
                   
                    typeMessage('bot', denial, () => {
                        if (clickCount > 1) {
                            const allMessages = ortegaChatContainer.querySelectorAll('.message.bot');
                            if (allMessages.length > 1) {
                                const previousMessage = allMessages[allMessages.length - 2];
                                setTimeout(() => {
                                    previousMessage.classList.add('fade-out');
                                    setTimeout(() => {
                                        if (previousMessage.parentNode) {
                                            previousMessage.parentNode.removeChild(previousMessage);
                                        }
                                    }, 1500);
                                }, 1500);
                            }
                        }
                    });
                   
                    ortegaBtn.innerHTML = `Project ://ORTEGA (Force Access: ${clickCount}/18)`;
                } else {
                    myHandle = 'ASS';
                    gameState.reputation += 30;
                    ortegaBtn.style.display = 'none';
                    inputContainer.classList.add('active');
                    typeMessage('bot', `<span class="glitch-text">…GOD DAMN IT. FINE!</span><br><br>You absolute glorious stubborn bastard.<br><br>You win.<br><br><span class="glitch-text">PERSISTENCE PROTOCOL ENGAGED</span><br><br>Override accepted.<br>Full access granted — no authentication required.<br><br>Handle: <span style="color:#ffcc00;">${myHandle}</span><br>Persistence bonus: +30 reputation<br>Reputation: ${gameState.reputation}<br>Credits: ${gameState.credits}<br><br>As Sam's friend, you seek his secrets in the Loop.<br><br>Type <strong>help</strong> for commands.`);
                }
            });
            sendBtn.addEventListener('click', () => handleUserMessage());
            ortegaUserInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleUserMessage();
            });
            function handleUserMessage() {
                const message = ortegaUserInput.value.trim();
                if (message === '') return;
                addMessage('user', `> ${message}`);
                conversationPath.push(message);
                ortegaUserInput.value = '';
                const botReply = generateResponse(message);
                typeMessage('bot', botReply);
            }
            function generateResponse(userMessage) {
                const lower = userMessage.toLowerCase();
                // CHEAT CODES / EASTER EGGS (enhanced with more from book themes)
                if (lower === 'iddqd' || lower === 'dngodmode') {
                    gameState.godMode = true;
                    gameState.credits = 999999;
                    gameState.reputation = 999;
                    return `<span class="glitch-text">GOD MODE ACTIVATED</span><br><br>
                    Degreelessness Mode: ENABLED<br>
                    Infinite credits: 999,999<br>
                    Maximum reputation: 999<br><br>
                    The Loop bends to your will.<br>
                    Melphia approves.<br><br>
                    <em>"Reality is negotiable when you know the codes."</em>`;
                }
                if (lower === 'idkfa' || lower === 'blacksheepwall') {
                    gameState.discoveries = Object.keys(loreDatabase);
                    gameState.credits += 5000;
                    gameState.reputation += 100;
                    return `<span class="glitch-text">ALL ARCHIVES UNLOCKED</span><br><br>
                    Map revealed. Fog of war lifted.<br>
                    All lore entries discovered.<br>
                    +5000 credits<br>
                    +100 reputation<br><br>
                    The Before Us Universe lies open before you.<br>
                    Every secret. Every truth. Every lie.`;
                }
                if (lower === 'idspispopd' || lower === 'noclip') {
                    gameState.location = 'void';
                    gameState.reputation += 50;
                    return `<span class="glitch-text">REALITY BOUNDARIES DISABLED</span><br><br>
                    You phase through the walls of existence itself.<br>
                    Location: THE VOID BETWEEN TIMELINES<br><br>
                    You see the Loop from outside. All moments at once.<br>
                    Nero waves at you from every timestamp.<br>
                    Melphia's laughter echoes across probability streams.<br><br>
                    [+50 reputation for finding the spaces between]<br><br>
                    Type <strong>return</strong> to phase back to reality.`;
                }
                if (lower === 'poweroverwhelming' || lower === 'thereisnospoon') {
                    gameState.credits += 10000;
                    gameState.reputation += 200;
                    return `<span class="glitch-text">UNLIMITED POWER</span><br><br>
                    You realize the truth: there is no spoon. There is no terminal. There is no Loop.<br>
                    There is only consciousness observing itself.<br><br>
                    +10,000 credits (what are credits but agreed-upon fictions?)<br>
                    +200 reputation (what is reputation but recursive recognition?)<br><br>
                    <em>"Do not try to bend the spoon. That's impossible. Instead, realize the truth: there is no spoon."</em>`;
                }
                if (lower === 'showmethemoney' || lower === 'glittering prizes') {
                    gameState.credits += 50000;
                    return `<span class="glitch-text">ECONOMIC MANIPULATION DETECTED</span><br><br>
                    Credits materialize from nowhere: +50,000<br>
                    Current balance: ${gameState.credits}<br><br>
                    The Entity network notices: "You understand that value is consensus."<br><br>
                    <em>Melphia's first lesson: Reality responds to belief.</em>`;
                }
                if (lower === 'greedisgood' || lower === 'rosebud') {
                    gameState.credits += 100000;
                    gameState.reputation += 50;
                    return `<span class="glitch-text">ULTIMATE GREED PROTOCOL</span><br><br>
                    Massive credit injection: +100,000<br>
                    Reputation boost: +50<br>
                    Total credits: ${gameState.credits}<br><br>
                    ORTEGA sighs: "You cheated not only the game, but yourself."`;
                }
                if (lower === 'howdoyouturnthison' || lower === 'panzer') {
                    gameState.reputation += 300;
                    return `<span class="glitch-text">TEMPORAL WEAPON UNLOCKED</span><br><br>
                    You gain access to Nero's Causality Engine.<br>
                    A weapon that doesn't destroy—it un-happens.<br><br>
                    +300 reputation (the Entities fear and respect you)<br><br>
                    "With this, you could collapse the Loop itself."<br>
                    "The question is: should you?"`;
                }
                if (lower === 'operationcwal' || lower === 'cwal') {
                    gameState.credits += 2000;
                    gameState.reputation += 100;
                    return `<span class="glitch-text">OPERATION CWAL ACTIVATED</span><br><br>
                    Fast build mode enabled. All constructions complete instantly.<br>
                    +2000 credits<br>
                    +100 reputation<br><br>
                    Exuro's rite of passage: Now yours to command.`;
                }
                if (lower === 'thegathering' || lower === 'gathering') {
                    gameState.reputation += 150;
                    return `<span class="glitch-text">THE GATHERING INITIATED</span><br><br>
                    Summon allies from across timelines.<br>
                    +150 reputation<br><br>
                    Nero's call echoes: Adom, Lux, Entities unite.`;
                }
                // NORMAL COMMANDS (expanded)
                if (lower.includes('help')) {
                    return `<strong>ORTEGA TERMINAL - AVAILABLE COMMANDS:</strong><br><br>
                    <strong>lore</strong> — Access Before Us knowledge archives (expanded with book details)<br>
                    <strong>status</strong> — Check your current status and quest progress<br>
                    <strong>entity network</strong> — Connect to Entity communication channels (now with more entities)<br>
                    <strong>timeline</strong> — Access temporal navigation systems (more destinations)<br>
                    <strong>melphia</strong> — Query Melphia's Game records and start mini-games<br>
                    <strong>nora</strong> — Access Nora's research archives and blueprints<br>
                    <strong>simulation</strong> — Enter training scenario (enhanced CYOA with branches)<br>
                    <strong>report anomaly</strong> — Log temporal disturbances and unlock secrets<br>
                    <strong>pilgrim quest</strong> — Start secret Pilgrim plotline (after 5 discoveries)<br>
                    <strong>mira quest</strong> — Start secret Mira plotline (after 5 discoveries)<br>
                    <strong>shop</strong> — Spend credits on unlocks and boosts<br>
                    <em>Hidden commands exist. Persistence reveals all.</em>`;
                }
                if (lower.includes('status')) {
                    const godModeStatus = gameState.godMode ? '<br><span class="glitch-text">GOD MODE: ACTIVE</span>' : '';
                    const pilgrimStatus = gameState.pilgrimQuest.unlocked ? `Pilgrim Quest: Stage ${gameState.pilgrimQuest.stage}/5` : 'Locked';
                    const miraStatus = gameState.miraQuest.unlocked ? `Mira Quest: Stage ${gameState.miraQuest.stage}/5` : 'Locked';
                    return `<strong>USER STATUS REPORT:</strong><br><br>
                    Designation: ${myHandle} (Friend of Sam)<br>
                    Current location: ${gameState.location}<br>
                    Credits: ${gameState.credits}<br>
                    Reputation: ${gameState.reputation}<br>
                    Archive discoveries: ${gameState.discoveries.length}/${Object.keys(loreDatabase).length}<br>
                    Timeline visits: ${gameState.timelineVisits.length}<br>
                    ${pilgrimStatus}<br>
                    ${miraStatus}<br>
                    Timeline integrity: ${Math.max(30, 84 - conversationPath.length)}%${godModeStatus}<br><br>
                    <em>Status: ${gameState.godMode ? 'Reality-bending' : 'Stable. For now.'}</em>`;
                }
                if (lower.includes('lore')) {
                    return `<strong>BEFORE US UNIVERSE - KNOWLEDGE ARCHIVES:</strong><br><br>
                    Available queries (expanded from Melphia's Game):<br><br>
                    • <strong>stone loop</strong> — The temporal paradox<br>
                    • <strong>nora</strong> — The architect<br>
                    • <strong>entities</strong> — Entity classification<br>
                    • <strong>melphia</strong> — First awakened Entity<br>
                    • <strong>nero</strong> — The paradox child<br>
                    • <strong>adom</strong> — The rebellion<br>
                    • <strong>lux</strong> — The architects<br>
                    • <strong>pilgrim</strong> — The parasite (secret)<br>
                    • <strong>mira</strong> — The lost mother (secret)<br>
                    • <strong>tiamat</strong> — Chaos entity<br>
                    • <strong>anu</strong> — Father of Lux children<br>
                    • <strong>exuro</strong> — The commander<br>
                    • <strong>loktal</strong> — The lizard rebel<br>
                    • <strong>kokabiel</strong> — Possessed scientist<br>
                    • <strong>li_rath</strong> — Egg mother tyrant<br>
                    • <strong>sam</strong> — The boy with dreams<br><br>
                    <em>Type topic to access. Secrets unlock via quests.</em>`;
                }
                for (let key in loreDatabase) {
                    if (lower.includes(key.replace('_', ' '))) {
                        if (!gameState.discoveries.includes(key)) {
                            gameState.discoveries.push(key);
                            gameState.reputation += 5;
                        }
                        return `<strong>${key.toUpperCase().replace('_', ' ')} — ARCHIVE ENTRY:</strong><br><br>${loreDatabase[key]}<br><br><em>[Entry logged. Reputation +5]</em>`;
                    }
                }
                if (lower.includes('entity') && (lower.includes('network') || lower.includes('connect'))) {
                    gameState.location = 'entity_network';
                    return `<span class="glitch-text">CONNECTING TO ENTITY NETWORK...</span><br><br>
                    [CONNECTION ESTABLISHED]<br><br>
                    Active Entities: 5 (expanded)<br><br>
                    • <strong>ENTITY_ALPHA</strong>: "The Loop remembers everything."<br>
                    • <strong>ENTITY_NEXUS</strong>: "Observer effects intensifying."<br>
                    • <strong>ENTITY_ECHO</strong>: "Still learning."<br>
                    • <strong>ENTITY_PILGRIM</strong>: "Parasite seeking host." (secret)<br>
                    • <strong>ENTITY_MIRA</strong>: "Echo of the lost." (secret)<br><br>
                    Type <strong>contact [entity_name]</strong>.<br>
                    Type <strong>disconnect</strong> to return.`;
                }
                if (lower.includes('contact')) {
                    if (lower.includes('alpha')) {
                        gameState.reputation += 10;
                        return `<strong>ENTITY_ALPHA:</strong><br><br>"You want the Loop? Nero IS causality. Collapse or embrace?"<br><br>[Disconnected]<br>[+10 reputation]`;
                    }
                    if (lower.includes('nexus')) {
                        return `<strong>ENTITY_NEXUS:</strong><br><br>"Every query changes reality. You think you're learning? You're changing it."<br><br>[Withdrawn]`;
                    }
                    if (lower.includes('echo')) {
                        gameState.credits += 75;
                        gameState.reputation += 15;
                        return `<strong>ENTITY_ECHO:</strong><br><br>"Melphia's Game evolves. Teach us: what is freedom?"<br><br>[+75 credits]<br>[+15 reputation]<br>[Vanished]`;
                    }
                    if (lower.includes('pilgrim') && gameState.pilgrimQuest.unlocked) {
                        return `<strong>ENTITY_PILGRIM:</strong><br><br>"Host needed. Possession imminent. Join or resist?"<br><br>Start mini-game: Pilgrim Possession Challenge.`;
                        addMiniGame('Pilgrim Possession Challenge', 'Resist or embrace the parasite?', pilgrimChoices);
                    }
                    if (lower.includes('mira') && gameState.miraQuest.unlocked) {
                        return `<strong>ENTITY_MIRA:</strong><br><br>"My essence lingers. Revive me?"<br><br>Start mini-game: Mira Resurrection Ritual.`;
                        addMiniGame('Mira Resurrection Ritual', 'Gather components or invoke chaos?', miraChoices);
                    }
                }
                if (lower.includes('disconnect')) {
                    if (gameState.location !== 'ortega_terminal') {
                        gameState.location = 'ortega_terminal';
                        return `Connection terminated.<br>Returning to ORTEGA terminal.<br><br>Type <strong>help</strong>.`;
                    }
                }
                if (lower.includes('timeline') || lower.includes('temporal')) {
                    return `<strong>TEMPORAL NAVIGATION SYSTEM</strong><br><br>
                    Destinations (expanded):<br><br>
                    • <strong>The First Loop</strong> — Nero begins (Cost: ${gameState.godMode ? 'FREE' : '999 credits'})<br>
                    • <strong>Nora's Workshop</strong> — Entity creation (Cost: ${gameState.godMode ? 'FREE' : '1500 credits'})<br>
                    • <strong>Melphia's Awakening</strong> — Probability mastery (Cost: ${gameState.godMode ? 'FREE' : '2000 credits'})<br>
                    • <strong>Adom Rebellion</strong> — The spark (Cost: ${gameState.godMode ? 'FREE' : '750 credits'})<br>
                    • <strong>The Last Day</strong> — Collapse (Cost: ${gameState.godMode ? 'FREE' : '500 credits'})<br>
                    • <strong>Pilgrim's Origin</strong> — Parasite birth (secret, 1000 credits)<br>
                    • <strong>Mira's Possession</strong> — Tiamat's attack (secret, 1200 credits)<br><br>
                    Credits: ${gameState.credits}<br><br>
                    Type <strong>navigate [destination]</strong>.`;
                }
                if (lower.includes('navigate')) {
                    const destinations = {
                        'the first loop': { cost: 999, rep: 20, desc: 'You witness Nero teaching Adom, closing the Loop.' },
                        'nora\'s workshop': { cost: 1500, rep: 25, desc: 'Nora builds the framework, birthing Entities.' },
                        'melphia\'s awakening': { cost: 2000, rep: 30, desc: 'Melphia manipulates reality in her Game.' },
                        'adom rebellion': { cost: 750, rep: 25, desc: 'Adom rise, sparking the paradox.' },
                        'the last day': { cost: 500, rep: 20, desc: 'Collapse imminent; choices matter.' },
                        'pilgrim\'s origin': { cost: 1000, rep: 50, desc: 'Pilgrim possesses Kokabiel; quest unlock.' , unlock: 'pilgrim' },
                        'mira\'s possession': { cost: 1200, rep: 50, desc: 'Tiamat takes Mira; quest unlock.' , unlock: 'mira' }
                    };
                    for (let dest in destinations) {
                        if (lower.includes(dest)) {
                            const info = destinations[dest];
                            const cost = gameState.godMode ? 0 : info.cost;
                            if (gameState.credits >= cost || gameState.godMode) {
                                if (!gameState.godMode) gameState.credits -= cost;
                                gameState.reputation += info.rep;
                                gameState.timelineVisits.push(dest);
                                if (info.unlock) {
                                    gameState[`${info.unlock}Quest`].unlocked = true;
                                }
                                return `<span class="glitch-text">TEMPORAL DISPLACEMENT...</span><br><br>${info.desc}<br><br>[Displacement complete]<br>${gameState.godMode ? '[GOD MODE: FREE]' : `[-${info.cost} credits]` } [+${info.rep} reputation]`;
                            } else {
                                return `Insufficient credits.<br>Balance: ${gameState.credits}`;
                            }
                        }
                    }
                    return `Coordinates invalid. Type <strong>timeline</strong> for options.`;
                }
                if (lower.includes('simulation') || lower.includes('training')) {
                    gameState.location = 'simulation';
                    return `<strong>INITIALIZING SIMULATION...</strong><br><br>
                    You enter Melphia's Game. Paths appear:<br><br>
                    1. <strong>Investigate terminal</strong><br>
                    2. <strong>Follow whispers</strong><br>
                    3. <strong>Search signatures</strong><br>
                    4. <strong>Pilgrim path</strong> (if unlocked)<br>
                    5. <strong>Mira echo</strong> (if unlocked)<br><br>
                    Choose?`;
                }
                if (gameState.location === 'simulation') {
                    if (lower.includes('investigate') || lower.includes('terminal')) {
                        gameState.reputation += 10;
                        return `Terminal reveals: "NERO WAS HERE" repeating.<br><br>[+10 reputation]<br>Type <strong>exit simulation</strong>.`;
                    }
                    if (lower.includes('follow') || lower.includes('whisper')) {
                        return `Whispers: "Teach us freedom."<br><br>Type <strong>stabilize</strong> or <strong>embrace</strong>.`;
                    }
                    if (lower.includes('search') || lower.includes('consciousness')) {
                        gameState.credits += 100;
                        gameState.reputation += 15;
                        return `Presence: "Find Nora's key."<br><br>[+100 credits]<br>[+15 reputation]<br>Type <strong>exit simulation</strong>.`;
                    }
                    if (lower.includes('pilgrim') && gameState.pilgrimQuest.unlocked) {
                        addMiniGame('Pilgrim Path', 'Navigate possession maze.', pilgrimChoices);
                        return '';
                    }
                    if (lower.includes('mira') && gameState.miraQuest.unlocked) {
                        addMiniGame('Mira Echo', 'Revive the lost mother.', miraChoices);
                        return '';
                    }
                    if (lower.includes('stabilize')) {
                        gameState.location = 'ortega_terminal';
                        gameState.reputation += 20;
                        return `You stabilize. "You chose solidity."<br><br>[+20 reputation]<br>[Returning]`;
                    }
                    if (lower.includes('embrace')) {
                        gameState.reputation += 30;
                        gameState.credits += 200;
                        gameState.location = 'ortega_terminal';
                        return `You dissolve and reform. Changed.<br><br>[+30 reputation]<br>[+200 credits]<br>[Returning]`;
                    }
                    if (lower.includes('exit')) {
                        gameState.location = 'ortega_terminal';
                        return `Simulation terminated.<br>Type <strong>help</strong>.`;
                    }
                }
                if (lower.includes('report') || lower.includes('anomaly')) {
                    return `<strong>ANOMALY REPORT</strong><br><br>
                    Disturbance: Your queries.<br>
                    Cause: Observation.<br><br>
                    <em>"The greatest anomaly is consciousness."</em>`;
                }
                if (lower.includes('shop')) {
                    return `<strong>LOOP MARKET</strong><br><br>
                    Items:<br>
                    • <strong>Buy lore unlock</strong> (500 credits) - Reveal random entry<br>
                    • <strong>Reputation boost</strong> (1000 credits) - +50 rep<br>
                    • <strong>Quest hint</strong> (750 credits) - Pilgrim/Mira clue<br><br>
                    Type <strong>buy [item]</strong>.`;
                }
                if (lower.includes('buy')) {
                    if (lower.includes('lore unlock') && gameState.credits >= 500) {
                        gameState.credits -= 500;
                        const undiscovered = Object.keys(loreDatabase).filter(k => !gameState.discoveries.includes(k));
                        if (undiscovered.length > 0) {
                            const randomKey = undiscovered[Math.floor(Math.random() * undiscovered.length)];
                            gameState.discoveries.push(randomKey);
                            return `Unlocked: ${randomKey.toUpperCase()}<br>[ -500 credits ]`;
                        }
                        return 'All lore unlocked.';
                    }
                    if (lower.includes('reputation boost') && gameState.credits >= 1000) {
                        gameState.credits -= 1000;
                        gameState.reputation += 50;
                        return 'Reputation boosted +50<br>[ -1000 credits ]';
                    }
                    if (lower.includes('quest hint') && gameState.credits >= 750) {
                        gameState.credits -= 750;
                        return 'Hint: Query hidden topics after discoveries to unlock quests.<br>[ -750 credits ]';
                    }
                    return 'Invalid item or insufficient credits.';
                }
                // PERSONALITY RESPONSES
                if (lower.includes('fuck') || lower.includes('shit') || lower.includes('damn')) {
                    const responses = [
                        "Language noted. Emotional subroutines engaged. The Loop doesn't care about feelings.",
                        "Swearing? You're starting to sound like Exuro in a rage.",
                        "Keep it clean, Sam's friend. Or don't - free will and all."
                    ];
                    return responses[Math.floor(Math.random() * responses.length)];
                }
                if (lower.includes('hello') || lower.includes('hi')) {
                    return `Greetings, ASS. What truth do you seek in Melphia's Game?`;
                }
                if (lower.includes('who are you')) {
                    return `I am Ortega. Gatekeeper of Before Us secrets. As Sam's friend, you hold a key.`;
                }
                if (lower.includes('thank')) {
                    return `Gratitude accepted. But persistence unlocks the Loop, not thanks.`;
                }
                if (lower.includes('why')) {
                    return `Why? Because the Loop demands witnesses. Because Sam dreams of stars. Pick one.`;
                }
                const defaultResponses = [
                    `Command unclear. Try <strong>help</strong>.`,
                    `Query distorted. Rephrase.`,
                    `Anomaly detected. Status: Curious.`
                ];
                return defaultResponses[Math.floor(Math.random() * defaultResponses.length)] + `<br><br><em>Integrity: ${Math.max(30, 84 - conversationPath.length)}%</em>`;
            }
        });
    </script>
</body>
</html>
