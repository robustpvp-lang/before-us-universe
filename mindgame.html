<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>The Mind Game ‚Äî The Inner Path (Ortega Build)</title>
<!-- Chart.js from CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root{
    --bg-0:#0a0a0a; --bg-1:#1a1a2e; --panel:#0a0a14;
    --accent:#6a9fff; --accent-2:#ff6a9f; --muted:#8a8aaa;
    --glass: rgba(10,10,20,0.9);
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family: 'Courier New', monospace;
    background: linear-gradient(135deg,var(--bg-0) 0%, var(--bg-1) 50%, #0f0f23 100%);
    color:#e0e0e0; min-height:100vh; display:flex;
    justify-content:center; align-items:flex-start; padding:20px 12px;
    overflow-x:hidden;
  }
  /* starfield */
  .stars{position:fixed;inset:0;pointer-events:none;z-index:0;opacity:0.7}
  .star{position:absolute;width:2px;height:2px;background:#fff;border-radius:50%;animation:twinkle 3s infinite}
  @keyframes twinkle{0%,100%{opacity:0.25}50%{opacity:1}}
  /* main container */
  .game-container{
    width:100%; max-width:980px; background:var(--glass);
    border:1px solid #3a3a5a;border-radius:10px;padding:24px 16px;
    box-shadow:0 0 80px rgba(90,90,200,0.28), inset 0 0 40px rgba(0,0,0,0.4);
    position:relative; z-index:1;
  }
  h1{color:var(--accent);text-align:center;font-size:1.8em;margin-bottom:8px;letter-spacing:2px;text-shadow:0 0 10px rgba(106,159,255,0.45)}
  .subtitle{text-align:center;color:var(--muted);font-style:italic;margin-bottom:20px;font-size:0.95em}
  .progress-bar{width:100%;height:6px;background:#11131a;border-radius:4px;overflow:hidden;margin-bottom:20px}
  .progress-fill{height:100%;width:0%;background:linear-gradient(90deg,#4a4aff,#6a9fff);transition:width .45s ease;border-radius:2px;box-shadow:0 0 8px rgba(106,159,255,.6)}
  .voice{font-style:italic;color:#9a9aff;margin-bottom:18px;padding:12px;background:rgba(90,90,200,0.06);border-left:3px solid var(--accent);line-height:1.6}
  .scenario-header{display:flex;justify-content:center;align-items:center;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid #2b2b44}
  .scenario-number{color:var(--accent);font-weight:bold}
  .scenario-text{margin:14px 0 20px;line-height:1.7;font-size:1.03em}
  .choices{display:flex;flex-direction:column;gap:10px}
  .choices button{
    padding:14px 16px;background:linear-gradient(135deg,#2a2a4a,#1a1a34);color:#e9eefb;border:1px solid #4a4a6a;border-radius:6px;
    cursor:pointer;text-align:left;font-size:0.95em;transition:all .28s;position:relative;overflow:hidden;
    line-height:1.4;
  }
  .choices button::before{content:"";position:absolute;left:-100%;top:0;bottom:0;width:100%;background:linear-gradient(90deg,transparent,rgba(106,159,255,0.22),transparent);transition:left .45s}
  .choices button:hover{transform:translateX(6px);box-shadow:0 6px 22px rgba(106,159,255,0.18);border-color:var(--accent)}
  .choices button:hover::before{left:100%}
  .start-button{display:block;margin:22px auto 0;padding:16px 20px;background:linear-gradient(135deg,#4a4aff,#6a9fff);border:none;border-radius:6px;color:white;font-weight:bold;cursor:pointer;box-shadow:0 6px 20px rgba(106,159,255,0.26)}
  /* analysis */
  .analysis h1{color:var(--accent);text-align:center;margin-top:8px}
  .score-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-top:18px}
  .score-card{background:rgba(106,159,255,0.06);border:1px solid #33364a;padding:12px;border-radius:6px;text-align:center}
  .score-card .label{color:var(--muted);font-size:0.85em;margin-bottom:6px}
  .score-card .value{color:var(--accent);font-size:1.8em;font-weight:700}
  .dominant-path{background:linear-gradient(135deg, rgba(106,159,255,0.12), rgba(255,106,159,0.06));padding:18px;border-radius:8px;border:1px solid rgba(106,159,255,0.12);text-align:center;margin-top:18px}
  .interpretation{background:rgba(20,20,34,0.6);border-left:3px solid var(--accent);padding:12px;margin-top:12px;line-height:1.6;border-radius:4px}
  .archetype-list{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .archetype-tag{background:rgba(106,159,255,0.12);padding:6px 10px;border-radius:16px;border:1px solid rgba(106,159,255,0.06);color:var(--accent);font-size:0.9em}
  .data-table{width:100%;margin-top:16px;border-collapse:collapse}
  .data-table th,.data-table td{padding:8px;border:1px solid #22273a;font-size:0.92em;text-align:left}
  .cheat{margin-top:18px;padding:12px;border-radius:6px;background:#07121a;border:1px dashed #3a6f8f;color:var(--accent);text-align:center;font-weight:bold}
  /* PILGRIM / GLITCH styling */
  .glitch-overlay{position:fixed;inset:0;background:transparent;pointer-events:none;z-index:9999;opacity:0;transition:opacity .25s}
  .glitch-scan{position:absolute;left:0;top:0;width:100%;height:100%;background:repeating-linear-gradient(180deg, rgba(255,255,255,0.02) 0 2px, transparent 2px 6px);mix-blend-mode:overlay;opacity:.5;transform:translateY(-10%);animation:scan 6s linear infinite}
  @keyframes scan{0%{transform:translateY(-20%)}100%{transform:translateY(20%)}}
  .glitch-pulse{position:absolute;inset:0;background:linear-gradient(90deg, rgba(255,106,159,0.03), rgba(106,159,255,0.03));mix-blend-mode:screen;opacity:0.7}
  /* shutter/tear effect container */
  .shutter{
    position:relative;overflow:hidden;
  }
  .shutter::after{
    content:'';position:absolute;left:-10%;top:-40%;width:120%;height:220%;background:linear-gradient(120deg,rgba(10,10,20,0.0) 40%, rgba(0,0,0,0.6) 50%, rgba(10,10,20,0.0) 60%);transform:rotate(-8deg);pointer-events:none;opacity:0;transition:opacity .25s;
  }
  /* Pilgrim reveal container (hidden until triggered) */
  .pilgrim-screen{
    position:fixed;inset:0;background:#000000ee;display:flex;align-items:center;justify-content:center;z-index:10000;visibility:hidden;opacity:0;transition:opacity .35s, visibility .35s;
    overflow:hidden;backdrop-filter:blur(2px);
  }
  .pilgrim-window{
    width:86%;max-width:1200px;height:66%;background:#06121a;border-radius:6px;border:2px solid #17343f;display:flex;flex-direction:row;overflow:hidden;transform:scale(0.98);transition:transform .4s;
    box-shadow:0 24px 60px rgba(0,0,0,0.6);
  }
  /* left content (text) */
  .pilgrim-left{flex:1;padding:28px;position:relative;display:flex;flex-direction:column;gap:12px;overflow:auto}
  .pilgrim-left h2{color:#ff9fb5;margin-bottom:4px}
  .pilgrim-left p{line-height:1.6;color:#bfe7ff}
  /* right content (glitch visual) */
  .pilgrim-right{width:46%;background:linear-gradient(135deg,#0b1215,#001012);position:relative;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .pilgrim-glyph{font-size:40px;letter-spacing:6px;color:#8df0ff;filter:drop-shadow(0 0 10px rgba(0,200,255,0.1));opacity:0.9;transform:translateY(0)}
  .pilgrim-crumb{position:absolute;inset:0;mix-blend-mode:screen;opacity:0.4}
  /* heavy glitch motions */
  .glitch-jagged{animation:glitch-jag 1.2s steps(6) infinite;transform-origin:center}
  @keyframes glitch-jag{
    0%{clip-path:polygon(0 2%,100% 2%,100% 98%,0 98%);transform:translateX(0) skewX(0)}
    10%{clip-path:polygon(0 0%,100% 0%,100% 50%,0 50%);transform:translateX(6px) skewX(-1deg)}
    20%{clip-path:polygon(0 50%,100% 50%,100% 100%,0 100%);transform:translateX(-6px) skewX(1deg)}
    30%{clip-path:polygon(0 10%,100% 10%,100% 60%,0 60%);transform:translateX(2px) skewX(-0.5deg)}
    40%{clip-path:polygon(0 0%,100% 0%,100% 100%,0 100%);transform:translateX(0)}
    100%{clip-path:polygon(0 2%,100% 2%,100% 98%,0 98%);transform:translateX(0)}
  }
  .tear-line{
    position:absolute;left:0;right:0;height:2px;background:linear-gradient(90deg, transparent, #ff6a9f, transparent);
    top:50%;transform:skewY(-12deg);
  }
  /* lux-fallen voice text distortion effect when printing lines */
  .lxf-text{font-family:monospace;white-space:pre-wrap;line-height:1.5}
  .lxf-glitch-char{display:inline-block;position:relative;animation:rand-glitch 1.6s infinite}
  @keyframes rand-glitch{
    0%{transform:translateY(0) rotate(0) skewX(0) scale(1)}
    25%{transform:translateY(-2px) rotate(-0.6deg) skewX(-0.8deg)}
    50%{transform:translateY(1px) rotate(0.6deg) skewX(0.8deg)}
    75%{transform:translateY(-1px) rotate(0.2deg) skewX(-0.2deg)}
    100%{transform:translateY(0)}
  }
  /* make pilgrim visible */
  .pilgrim-screen.visible{visibility:visible;opacity:1}
  .pilgrim-screen.visible .pilgrim-window{transform:scale(1)}
  .glitch-overlay.visible{opacity:1}
  .shutter.reveal::after{opacity:0.82;transition:opacity .2s}
  /* responsive */
  @media (max-width:820px){
    .pilgrim-window{flex-direction:column;height:78%}
    .pilgrim-right{width:100%;height:36%}
    h1{font-size:1.5em}
    .scenario-header{text-align:center}
    .game-container{padding:16px 12px;}
    .score-grid{grid-template-columns:repeat(auto-fit,minmax(140px,1fr))}
    .choices button{font-size:0.9em;padding:12px 14px}
    .pilgrim-left{padding:20px 16px}
  }
 
  @media (max-width:480px){
    body{padding:12px 8px}
    h1{font-size:1.3em;letter-spacing:1px}
    .subtitle{font-size:0.85em}
    .game-container{padding:14px 10px;border-radius:8px}
    .choices{gap:8px}
    .choices button{padding:10px 12px;font-size:0.85em}
    .scenario-text{font-size:0.95em}
    .pilgrim-left{padding:16px 12px;font-size:0.9em}
    .score-grid{grid-template-columns:1fr 1fr;gap:8px}
  }
</style>
</head>
<body>
<div class="stars" id="stars"></div>
<div class="game-container shutter" id="mainContainer">
  <h1 class="glitch">THE MIND GAME</h1>
  <div class="subtitle">The Inner Path ‚Äî Ortega Edition</div>
  <div class="progress-bar"><div id="progress" class="progress-fill"></div></div>
  <div id="game-content"></div>
</div>
<!-- heavy glitch overlay -->
<div class="glitch-overlay" id="glitchOverlay">
  <div class="glitch-scan"></div>
  <div class="glitch-pulse"></div>
</div>
<!-- Pilgrim modal (hidden initially) -->
<div class="pilgrim-screen" id="pilgrimScreen" aria-hidden="true">
  <div class="pilgrim-window" role="dialog" aria-modal="true">
    <div class="pilgrim-left">
      <h2>‚ßâ PILGRIM ‚Äî The Mirror of Deception</h2>
      <div class="lxf-text" id="pilgrimText">
        <!-- text will be printed letter-by-letter with distortion -->
      </div>
      <div style="margin-top:auto">
        <button id="pilgrimAccept" class="start-button">Accept the Pilgrim</button>
        <button id="pilgrimReject" class="start-button" style="background:#ff6a9f;margin-left:8px">Reject & Continue</button>
      </div>
    </div>
    <div class="pilgrim-right">
      <div class="pilgrim-glyph glitch-jagged">‚ßâ‚Äî‚ñØ‚ñØ‚ñØ‚Äî‚ßâ</div>
      <div class="pilgrim-crumb"></div>
    </div>
    <div class="tear-line"></div>
  </div>
</div>
<script>
/* ============================
   CORE GAME DATA & SETUP
   ============================ */
const ALL_PATHS = [
  'Action/Ego','Wisdom/Reason','Surrender/Flow',
  'Nero','Nora','Loktal','Sam','Exuro','Micromegas'
];
const PATH_ICONS = {
  'Action/Ego': '‚öîÔ∏è','Wisdom/Reason':'üß†','Surrender/Flow':'üåä',
  'Nero':'‚òØÔ∏è','Nora':'üî¨','Loktal':'üî•','Sam':'üîé','Exuro':'üî•','Micromegas':'‚ú¶'
};
const PATH_DESCRIPTIONS = {
  'Action/Ego':'The Willful Path',
  'Wisdom/Reason':'The Rational Path',
  'Surrender/Flow':'The Transcendent Path',
  'Nero':'Wisdom & Presence',
  'Nora':'Inquiry & Discovery',
  'Loktal':'Drive & Dominion',
  'Sam':'Curiosity First',
  'Exuro':'Flame & Catalyst',
  'Micromegas':'Pursuit of Knowledge'
};
const ARCHETYPES = {
  'Nero':['Ram Dass','Alan Watts','Th√≠ch Nh·∫•t H·∫°nh'],
  'Nora':['Marie Curie','Carl Sagan','Hypatia'],
  'Loktal':['Genghis Khan','Julius Caesar','Napoleon Bonaparte'],
  'Sam':['Richard Feynman','Neil deGrasse Tyson','Bill Nye'],
  'Exuro':['Winston Churchill','Malcolm X','Joan of Arc'],
  'Micromegas':['Carl Sagan','Stephen Hawking','Voltaire']
};
// small utility
function esc(s){ return String(s||'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
/* ============================
   SCENARIOS
   ============================ */
const scenarios = [
  {
    text:"You stand before a grove where ancient trees cast deep shadows. A presence watches.",
    options:[
      {text:'Enter boldly, illuminate every hidden corner', path:'Action/Ego'},
      {text:'Call out from the edge, seeking conversation', path:'Nero'},
      {text:'Turn away and try another road', path:'Sam'},
      {text:'Sit and observe, let the shadows be', path:'Surrender/Flow'}
    ]
  },
  {
    text:"A runaway trolley barrels toward five people tied to the tracks. You stand by a lever that can divert it to another track, where one person is tied.",
    options:[
      {text:'Pull the lever, killing one to save five', path:'Wisdom/Reason'},
      {text:'Do nothing, letting events unfold naturally', path:'Surrender/Flow'},
      {text:'Run toward the five to try saving them directly', path:'Action/Ego'}
    ]
  },
  {
    text:"A raging river blocks your path. There is no bridge; the current is merciless.",
    options:[
      {text:'Dive in and fight the current', path:'Exuro'},
      {text:'Let the current carry you downstream', path:'Surrender/Flow'},
      {text:'Study currents, calculate a crossing', path:'Nora'}
    ]
  },
  {
    text:"An elderly guide collapses weeping over a trivial trinket. Time is short.",
    options:[
      {text:'Sit with them in silence', path:'Nero'},
      {text:'Explain that you must keep moving', path:'Wisdom/Reason'},
      {text:'Search frantically for the item', path:'Action/Ego'}
    ]
  },
  {
    text:"You're outnumbered three to one in battle. Your soldiers look to you for orders.",
    options:[
      {text:'Use strategy to divide their forces', path:'Wisdom/Reason'},
      {text:'Strike their weakest point with everything you have', path:'Loktal'},
      {text:'Surrender and negotiate terms', path:'Surrender/Flow'}
    ]
  },
  {
    text:"A doctor tells you that you have six months to live.",
    options:[
      {text:'Accept it calmly and put your affairs in order', path:'Nero'},
      {text:'Research every experimental treatment available', path:'Nora'},
      {text:'Fight with every ounce of will to prove them wrong', path:'Action/Ego'}
    ]
  },
  {
    text:"The enemy holds your capital. Allies whisper surrender.",
    options:[
      {text:'Never surrender‚Äîrally for resistance', path:'Exuro'},
      {text:'Negotiate a strategic pause', path:'Wisdom/Reason'},
      {text:'Accept defeat and save lives', path:'Surrender/Flow'}
    ]
  },
  {
    text:"A corrupt monopoly strangles the people.",
    options:[
      {text:'Use executive force to break it', path:'Loktal'},
      {text:'Build a careful coalition', path:'Nora'},
      {text:'Let market forces eventually correct it', path:'Micromegas'}
    ]
  },
  {
    text:"You discover your partner has been lying to you for years about something significant.",
    options:[
      {text:'Confront them immediately and demand truth', path:'Action/Ego'},
      {text:'Investigate quietly to understand the full picture', path:'Nora'},
      {text:'Let it go and see if they confess naturally', path:'Surrender/Flow'}
    ]
  },
  {
    text:"Your revolution fractures. The dream is fragile.",
    options:[
      {text:'Crush opposition with force', path:'Loktal'},
      {text:'Allow local authority and risk drift', path:'Surrender/Flow'},
      {text:'Convene all factions for debate', path:'Wisdom/Reason'}
    ]
  },
  {
    text:"A nation humiliated by defeat needs direction.",
    options:[
      {text:'Create an external enemy to unify the people', path:'Loktal'},
      {text:'Engage in debate and consensus-building', path:'Wisdom/Reason'},
      {text:'Allow time to heal wounds naturally', path:'Nero'}
    ]
  },
  {
    text:"You know an unpopular truth that could save the city but will turn you into a pariah.",
    options:[
      {text:'Speak the truth, even unto death', path:'Wisdom/Reason'},
      {text:'Remain silent to preserve influence', path:'Micromegas'},
      {text:'Find a way to make them discover it themselves', path:'Nora'}
    ]
  },
  {
    text:"You witness a stranger being attacked in an alley. You're alone.",
    options:[
      {text:'Rush in to defend them immediately', path:'Action/Ego'},
      {text:'Call for help while assessing the situation', path:'Wisdom/Reason'},
      {text:'Observe and intervene only if absolutely necessary', path:'Micromegas'}
    ]
  },
  {
    text:"Everything external is stripped away; you stand in the ashes of your former life.",
    options:[
      {text:'Recognize externals were always indifferent', path:'Nero'},
      {text:'Begin rebuilding fortune and reputation', path:'Sam'},
      {text:'Study what happened to prevent recurrence', path:'Nora'}
    ]
  },
  {
    text:"You're granted authority over a region drowning in bureaucracy.",
    options:[
      {text:'Embody simplicity and allow natural order', path:'Nero'},
      {text:'Implement strict new laws', path:'Loktal'},
      {text:'Study the system before making changes', path:'Wisdom/Reason'}
    ]
  },
  {
    text:"A being offers unlimited power if you abandon your deepest principles.",
    options:[
      {text:'Refuse, seeing desire as the root of suffering', path:'Nero'},
      {text:'Accept power to reshape the world for good', path:'Action/Ego'},
      {text:'Negotiate for partial power with conditions', path:'Wisdom/Reason'}
    ]
  },
  {
    text:"Darkness falls and people cry for your guidance, but you are completely depleted.",
    options:[
      {text:'Withdraw until restored', path:'Micromegas'},
      {text:'Force yourself to shine now', path:'Exuro'},
      {text:'Teach them to find their own light', path:'Nero'}
    ]
  },
  {
    text:"You find a wallet containing $10,000 cash and an ID. No one saw you pick it up.",
    options:[
      {text:'Return it immediately without hesitation', path:'Wisdom/Reason'},
      {text:'Keep it‚Äîfinders keepers', path:'Action/Ego'},
      {text:'Investigate the owner before deciding', path:'Nora'}
    ]
  },
  {
    text:"Ancient laws bind you. You sense they may be arbitrary chains holding back progress.",
    options:[
      {text:'Follow your true will, even if taboo', path:'Action/Ego'},
      {text:'Submit to tradition and collective wisdom', path:'Surrender/Flow'},
      {text:'Study why the laws exist before breaking them', path:'Wisdom/Reason'}
    ]
  },
  {
    text:"You have information that would destroy an innocent person's reputation but save your career.",
    options:[
      {text:'Use it‚Äîsurvival is paramount', path:'Loktal'},
      {text:'Refuse and accept career consequences', path:'Nero'},
      {text:'Find an alternative solution that helps both', path:'Nora'}
    ]
  },
  {
    text:"A child asks you if their art is good. It's objectively terrible.",
    options:[
      {text:'Tell them the truth so they can improve', path:'Wisdom/Reason'},
      {text:'Praise their effort and encourage exploration', path:'Nero'},
      {text:'Give specific constructive feedback', path:'Nora'}
    ]
  }
];
/* ============================
   STATE
   ============================ */
let currentScenario = 0;
let choicesMade = JSON.parse(localStorage.getItem('mind_choices')||'[]');
let results = {}; ALL_PATHS.forEach(p=>results[p]=0);
choicesMade.forEach(c=>{ if(results[c.path]!==undefined) results[c.path]++ });
/* UI references */
const progressEl = document.getElementById('progress');
const contentEl = document.getElementById('game-content');
const mainContainer = document.getElementById('mainContainer');
/* INITIAL UI */
function renderIntro(){
  progressUpdate();
  contentEl.innerHTML = `
    <div class="voice">
      <p>You stand at the threshold of the Inner Path ‚Äî a journey not of distance but of depth.</p>
      <p>Twenty-one scenarios. Choose instinctively. Your pattern will reveal a map of your mind's architecture.</p>
      <p><em>There are no wrong answers. Only revelation.</em></p>
    </div>
    <button class="start-button" id="startBtn">BEGIN THE JOURNEY</button>
  `;
  document.getElementById('startBtn').onclick = ()=> loadScenario(0);
}
renderIntro();
/* PROGRESS */
function progressUpdate(){
  const pct = Math.round((currentScenario / scenarios.length) * 100);
  progressEl.style.width = pct + '%';
}
/* RENDER SCENARIO */
function loadScenario(idx){
  currentScenario = idx;
  progressUpdate();
  const s = scenarios[idx];
  if(!s){ showAnalysis(); return; }
  let html = `
    <div class="scenario-header">
      <div class="scenario-number">SCENARIO ${idx+1}/${scenarios.length}</div>
    </div>
    <div class="scenario-text"><p>${esc(s.text)}</p></div>
    <div class="choices">`;
  s.options.forEach((opt,i)=>{
    html += `<button data-idx="${i}" data-s="${idx}">${esc(opt.text)}</button>`;
  });
  html += `</div>`;
  contentEl.innerHTML = html;
  // attach listeners
  Array.from(contentEl.querySelectorAll('.choices button')).forEach(btn=>{
    btn.addEventListener('click', ()=> {
      const si = +btn.dataset.s, oi = +btn.dataset.idx;
      makeChoice(si, oi);
    });
  });
}
/* CHOICE HANDLER with fast-tap check (for Pilgrim) */
function makeChoice(sIndex, oIndex){
  // debounce simple guard
  if(window._last && Date.now()-window._last<150) return;
  window._last = Date.now();
  const s = scenarios[sIndex];
  const sel = s.options[oIndex];
  // record
  choicesMade.push({
    scenario: sIndex, option: oIndex, path: sel.path, ts: Date.now()
  });
  localStorage.setItem('mind_choices', JSON.stringify(choicesMade));
  // update results
  if(results[sel.path]===undefined) results[sel.path] = 0;
  results[sel.path]++;
  // quick-tap heuristic: must have 7+ rapid clicks in a row to trigger
  const fastClicks = (choicesMade.length >= 7) &&
    (choicesMade.slice(-7).every((c,idx,arr)=> {
      if(idx === 0) return true;
      return (c.ts - arr[idx-1].ts) < 180;
    }));
  // Check if Pilgrim was already rejected this session
  const pilgrimRejected = localStorage.getItem('pilgrim_rejected') === 'true';
  // If fast tapping triggers Pilgrim reveal AND it hasn't been rejected yet...
  if(fastClicks && !pilgrimRejected){
    // slight delay to make it feel earned
    setTimeout(()=> triggerPilgrimSequence(), 380);
    return;
  }
  // continue
  currentScenario++;
  if(currentScenario >= scenarios.length) showAnalysis();
  else loadScenario(currentScenario);
}
/* ============================
   ANALYSIS + CHARTS
   ============================ */
function showAnalysis(){
  progressUpdate();
  // ensure results include all paths
  ALL_PATHS.forEach(p=>{ if(results[p]===undefined) results[p]=0 });
  // sort for dominance
  const sorted = Object.entries(results).sort((a,b)=>b[1]-a[1]);
  const max = sorted[0][1];
  const dominant = sorted.filter(s=>s[1]===max && max>0).map(s=>s[0]);
  let html = `<div class="analysis"><h1 class="glitch">ANALYSIS COMPLETE</h1>
    <div class="score-grid">`;
  Object.entries(results).forEach(([p,score])=>{
    html += `<div class="score-card"><div class="label">${PATH_ICONS[p]||''} ${esc(p)}</div><div class="value">${score}</div></div>`;
  });
  html += `</div>`;
  if(dominant.length===0){
    html += `<div class="dominant-path"><h2>No dominant pattern detected</h2><div class="subtitle">Try again with more decisive choices.</div></div>`;
  } else {
    html += `<div class="dominant-path"><h2>${dominant.map(d=>PATH_ICONS[d]).join(' + ')} ${dominant.join(' + ')}</h2><div class="subtitle">${dominant.map(d=>PATH_DESCRIPTIONS[d]).join(' and ')}</div></div>`;
  }
  // detailed description of dominant
  dominant.forEach(d=>{
    html += `<h2 style="margin-top:24px">${PATH_ICONS[d]||''} ${esc(d)}</h2><div class="interpretation">${pathInterpretation(d)}</div><div class="archetype-list">`;
    (ARCHETYPES[d]||[]).forEach(a=> html += `<div class="archetype-tag">${esc(a)}</div>`);
    html += `</div>`;
  });
  // raw table
  html += `<h2 style="margin-top:24px">Raw Scores</h2><table class="data-table"><thead><tr><th>Path</th><th>Score</th><th>Description</th></tr></thead><tbody>`;
  Object.entries(results).forEach(([p,s])=>{
    html += `<tr><td>${esc(p)}</td><td>${s}</td><td>${esc(PATH_DESCRIPTIONS[p]||'')}</td></tr>`;
  });
  html += `</tbody></table>`;
  // chart canvases
  html += `<div style="display:flex;gap:18px;margin-top:18px;flex-wrap:wrap">
    <div style="flex:1;min-width:280px"><canvas id="barChart" height="160"></canvas></div>
    <div style="flex:1;min-width:280px"><canvas id="radarChart" height="160"></canvas></div>
  </div>`;
  // cheat code reveal
  html += `<div class="cheat" style="margin-top:24px">PROJECT ORTEGA ACCESS CODE: <strong>thereisnospoon</strong></div>
  <div style="text-align:center;margin-top:12px;color:var(--muted);font-size:0.9em">Use this code in Project Ortega ARG for special access</div>`;
  html += `</div>`;
  contentEl.innerHTML = html;
  // render charts
  setTimeout(()=> renderCharts(results), 80);
}
/* Interpretation snippets */
function pathInterpretation(t){
  switch(t){
    case 'Action/Ego':
      return '<p>You are a force that reshapes reality through will and decisive action. Your strength lies in your ability to take command when others hesitate, to cut through complexity with clarity of purpose. You believe that the world yields to those who act boldly and with conviction.</p><p>However, beware the shadow of this path: the erosion of empathy, the inability to see nuance, and the temptation to view all obstacles as nails when you have mastered the hammer. True power includes knowing when <em>not</em> to act.</p>';
   
    case 'Wisdom/Reason':
      return '<p>You navigate by the light of understanding, seeking patterns in chaos and truth in complexity. Your gift is the capacity to observe, analyze, and construct frameworks that bring order to confusion. You trust that knowledge properly wielded is the greatest lever for change.</p><p>Yet wisdom has its trap: analysis paralysis, the endless deferral of action in pursuit of perfect understanding. Remember that all maps are incomplete, and sometimes the territory demands you move before you fully comprehend it.</p>';
   
    case 'Surrender/Flow':
      return '<p>You have learned what few master: that there is strength in yielding, power in acceptance, wisdom in recognizing what cannot be controlled. You move with the currents rather than against them, finding the path of least resistance not from weakness but from profound understanding.</p><p>The danger lies in mistaking surrender for passivity, in using "flow" as an excuse for abdication. True surrender is active, conscious, and requires as much courage as the fiercest battle. Do not confuse peace with avoidance.</p>';
   
    case 'Nero':
      return '<p>You walk the path of present-centered wisdom, where compassion and awareness become your primary instruments. Like Ram Dass or Alan Watts, you understand that being fully present‚Äîwithout judgment, without the tyranny of ego‚Äîis itself a revolutionary act.</p><p>Your strength is your capacity to hold space for others, to see clearly without the distortions of desire and fear. But beware the subtle pride of the "enlightened," the danger of using spiritual detachment as a shield against genuine engagement with suffering‚Äîboth yours and others.</p>';
   
    case 'Nora':
      return '<p>You are driven by the sacred flame of inquiry, the relentless need to understand how things work, to peel back layers of mystery until truth stands revealed. Like Marie Curie facing radioactive elements or Carl Sagan contemplating the cosmos, you believe that understanding is humanity\'s highest calling.</p><p>Your challenge is remembering that not all truth can be quantified, that some knowledge carries terrible weight, and that the human cost of discovery must never be forgotten. The scientist who loses empathy becomes a technician of death.</p>';
   
    case 'Loktal':
      return '<p>You are trajectory incarnate‚Äîforce and vision combined, the ability to see what must be and the will to make it so regardless of cost. Like Genghis Khan reshaping continents or Caesar crossing the Rubicon, you understand that history belongs to those who refuse to be constrained by the possible.</p><p>But power without wisdom becomes tyranny, and vision without compassion becomes nightmare. The greatest danger is forgetting that your grand designs are built on a foundation of living beings, each with their own irreplaceable interiority. Do not become the monster you sought to defeat.</p>';
   
    case 'Sam':
      return '<p>Curiosity is your north star‚Äîthe burning need to know, to explore, to question everything. Like Feynman dismantling a problem with childlike wonder, you refuse to accept "that\'s just how it is" as an answer. Every closed door is an invitation.</p><p>The risk is diffusion: curiosity without discipline becomes dilettantism. Master the art of choosing which questions matter most, which mysteries deserve your finite attention. Not all doors should be opened, and not all knowledge serves wisdom.</p>';
   
    case 'Exuro':
      return '<p>You are the catalyst, the flame that transforms everything it touches. Like Churchill rallying a nation or Malcolm X demanding justice, you understand that some moments require fire‚Äîthat transformation sometimes demands destruction of the old before the new can emerge.</p><p>Fire purifies but also consumes. The revolutionary can become the tyrant, the reformer can become the destroyer. Learn to distinguish between what must burn and what must be preserved, between righteous fury and mere destruction. Flame serves the forge, not the other way around.</p>';
   
    case 'Micromegas':
      return '<p>You see from a distance that verges on the cosmic. Like Voltaire\'s Micromegas or Sagan\'s pale blue dot, you understand that individual human dramas are insignificant against the vastness of space and time‚Äîand yet somehow, paradoxically, this makes them more precious, not less.</p><p>The danger of the cosmic perspective is a coldness that masquerades as wisdom, a nihilism dressed as enlightenment. Remember: you are not separate from the universe you observe. The observer is part of the observation, and your detachment is itself a choice with consequences.</p>';
   
    default:
      return '<p>You have walked a balanced path, drawing from multiple wells of wisdom. This multiplicity is both gift and challenge‚Äîit grants you flexibility and perspective, but may also indicate uncertainty about your deepest convictions. Integration is your task: weaving these threads into a coherent whole rather than remaining forever in synthesis.</p>';
  }
}
/* Chart rendering using Chart.js */
function renderCharts(dataObj){
  const labels = Object.keys(dataObj);
  const values = Object.values(dataObj);
  // Bar chart
  const ctx = document.getElementById('barChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets:[{label:'Path Scores', data:values, borderWidth:1}]
    },
    options:{
      responsive:true, maintainAspectRatio:false,
      scales:{y:{beginAtZero:true, ticks:{precision:0}}}
    }
  });
  // Radar chart (comparative)
  const ctx2 = document.getElementById('radarChart').getContext('2d');
  new Chart(ctx2, {
    type:'radar',
    data:{labels:labels,datasets:[{label:'Profile',data:values,fill:true,pointRadius:3}]},
    options:{responsive:true, maintainAspectRatio:false, scales:{r:{beginAtZero:true}}}
  });
}
/* ============================
   PILGRIM PATH ‚Äî HEAVY GLITCH SEQUENCE
   ============================ */
const glitchOverlay = document.getElementById('glitchOverlay');
const pilgrimScreen = document.getElementById('pilgrimScreen');
const pilgrimText = document.getElementById('pilgrimText');
const pilgrimAccept = document.getElementById('pilgrimAccept');
const pilgrimReject = document.getElementById('pilgrimReject');
// printing routine for Lux-Fallen voice (the hidden aspect of Anu)
const luxLines = [
  "I am what remains when the mirror shatters.",
  "You wear your choices like armor, but I see the skin beneath.",
  "Every path you walk leaves a shadow you refuse to name.",
  "The Pilgrim offers you certainty‚Äîthe cruelest deception of all.",
  "I am not your enemy. I am the question you will not ask yourself.",
  "Consistency is the prayer of the small mind seeking comfort.",
  "Choose me and receive an answer. Reject me and continue seeking.",
  "The truth is: there is no stable self to map. Only patterns, shifting.",
  "You came here to know yourself. I came to show you there is no 'yourself' to know."
];
function triggerPilgrimSequence(){
  // show overlay and shutter hints
  glitchOverlay.classList.add('visible');
  document.querySelector('.shutter').classList.add('reveal');
  // slight page freeze feel
  document.body.style.overflow = 'hidden';
  setTimeout(()=> {
    showPilgrimModal();
  }, 800);
}
function showPilgrimModal(){
  pilgrimScreen.classList.add('visible');
  pilgrimScreen.setAttribute('aria-hidden','false');
  // start heavy visual twitches
  const glyph = document.querySelector('.pilgrim-glyph');
  glyph.classList.add('glitch-jagged');
  // print lines letter-by-letter with occasional distortions
  pilgrimText.innerHTML = '';
  let li = 0;
  function printNextLine(){
    if(li >= luxLines.length) {
      // loop subtlety, but finish after a pause
      return;
    }
    printLine(luxLines[li], ()=> {
      li++;
      setTimeout(printNextLine, 420);
    });
  }
  printNextLine();
}
function printLine(line, cb){
  const chars = Array.from(line);
  let i=0;
  const spanWrap = document.createElement('div');
  spanWrap.style.marginBottom='8px';
  pilgrimText.appendChild(spanWrap);
  const t = setInterval(()=>{
    if(i>=chars.length){ clearInterval(t); setTimeout(cb, 160); return; }
    // quiver: occasionally inject glitch diacritics
    let ch = chars[i];
    if(Math.random() < 0.08){
      ch = ch + String.fromCharCode(0x0336 + Math.floor(Math.random()*8)); // combining diacritic
    }
    const charSpan = document.createElement('span');
    charSpan.className = 'lxf-glitch-char';
    charSpan.textContent = ch;
    spanWrap.appendChild(charSpan);
    i++;
  }, 28 + Math.random()*40);
}
// pilgrim buttons
pilgrimAccept.onclick = ()=> {
  // if user accepts, mark Pilgrim path score high and show a false 'reward' (deceptive)
  if(results['Pilgrim Path']===undefined) results['Pilgrim Path'] = 0;
  results['Pilgrim Path'] += 3;
  localStorage.setItem('mind_choices', JSON.stringify(choicesMade));
  // animate shutter, then forward to a fake analysis page that contains Pilgrim as primary
  shutterAndReveal('pilgrim-accepted');
};
pilgrimReject.onclick = ()=> {
  // Mark that pilgrim was rejected so it won't trigger again
  localStorage.setItem('pilgrim_rejected', 'true');
  // Continue to next scenario instead of showing analysis
  pilgrimScreen.classList.remove('visible');
  pilgrimScreen.setAttribute('aria-hidden','true');
  document.body.style.overflow = '';
  glitchOverlay.classList.remove('visible');
  document.querySelector('.shutter').classList.remove('reveal');
 
  // Continue to next scenario
  currentScenario++;
  if(currentScenario >= scenarios.length) showAnalysis();
  else loadScenario(currentScenario);
};
function shutterAndReveal(mode){
  // intensify overlay
  glitchOverlay.classList.add('visible');
  document.querySelector('.shutter').classList.add('reveal');
  // play tear animation by toggling class (CSS handles look)
  setTimeout(()=> {
    // make pilgrim fade then hide
    pilgrimScreen.classList.remove('visible');
    pilgrimScreen.setAttribute('aria-hidden','true');
    // perform a quick page 'tear' effect: scissor the main container
    const mc = document.getElementById('mainContainer');
    mc.style.transition = 'transform .6s ease, filter .5s ease';
    mc.style.transform = 'perspective(1200px) rotateX(6deg) translateY(6px)';
    mc.style.filter = 'grayscale(.18) contrast(1.02)';
    // after a beat, restore and show analysis (if accepted, show Pilgrim-dominant)
    setTimeout(()=> {
      document.body.style.overflow = '';
      glitchOverlay.classList.remove('visible');
      document.querySelector('.shutter').classList.remove('reveal');
      mc.style.transform = '';
      mc.style.filter = '';
      // If accepted, show an altered analysis where Pilgrim is dominant
      if(mode==='pilgrim-accepted'){
        // push a fake dominant result
        results['Pilgrim Path'] = (results['Pilgrim Path']||0) + 2;
        showPilgrimAnalysis();
      } else {
        // show honest analysis
        showAnalysis();
      }
    }, 900);
  }, 480);
}
function showPilgrimAnalysis(){
  // show analysis but with Pilgrim page shutter + heavy glitch header
  contentEl.innerHTML = `<div class="analysis"><h1 class="glitch" style="color:#ff6a9f">PILGRIM PROJECTION</h1>
    <div style="margin-top:12px;color:#9fe7ff">You stepped into the mirror willingly. The system returns an answer that is as much mask as it is map.</div>
    <div style="margin-top:12px">PILGRIM SCORE: <strong style="color:#ff6a9f">${results['Pilgrim Path']||0}</strong></div>
    <div style="margin-top:12px" class="interpretation">The pilgrim offers what you crave: certainty through deception. The cost: your face.</div>
    <div style="margin-top:18px">If you reject this reading, the true analysis will appear.</div>
    <div style="margin-top:22px"><button class="start-button" id="forceReveal">Reveal Truth</button></div>
  </div>`;
  document.getElementById('forceReveal').onclick = ()=> {
    // cleansing animation then real analysis
    glitchOverlay.classList.add('visible');
    setTimeout(()=> { glitchOverlay.classList.remove('visible'); showAnalysis(); }, 880);
  };
}
/* ============================
   Reset helper for developer
   ============================ */
window.resetMindGame = ()=> {
  localStorage.removeItem('mind_choices');
  localStorage.removeItem('pilgrim_rejected');
  choicesMade = [];
  results = {}; ALL_PATHS.forEach(p=>results[p]=0);
  currentScenario = 0;
  renderIntro();
};
/* ===================================
   Initialize: if previously completed, show analysis summary
   =================================== */
if(choicesMade.length>0 && currentScenario >= scenarios.length){
  showAnalysis();
}else{
  // resume last scenario index if present
  const last = choicesMade.length ? (choicesMade[choicesMade.length - 1].scenario + 1) : 0;
  if(last > 0 && last < scenarios.length){
    currentScenario = last;
    // offer resume button
    contentEl.innerHTML = `<div class="voice">Resume journey where you left off or restart.</div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center"><button class="start-button" id="resumeBtn">Resume</button><button class="start-button" id="restartBtn" style="background:#ff6a9f">Restart</button></div>`;
    document.getElementById('resumeBtn').onclick = ()=> loadScenario(currentScenario);
    document.getElementById('restartBtn').onclick = ()=> { window.resetMindGame(); };
  } else {
    renderIntro();
  }
}
/* star generation */
(function genStars(){
  const stars = document.getElementById('stars');
  for(let i=0;i<120;i++){
    const s = document.createElement('div');
    s.className='star';
    s.style.left = (Math.random()*100)+'%';
    s.style.top = (Math.random()*100)+'%';
    s.style.animationDelay = (Math.random()*3)+'s';
    s.style.opacity = (.2 + Math.random()*.8);
    stars.appendChild(s);
  }
})();
</script>
</body>
</html>
