<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Before Us Universe ‚Äî The Mind Game Text Adventure</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
    :root {
        --bg: #001a1a;
        --fg: #00ffff;
        --accent: #ffcc00;
        --border: #00cccc;
        --panel-bg: #002b2b;
        --text-gray: #e6f7f7;
        --muted: #00aaaa;
        --online: #00ff9d;
        --yahoo-blue: #1e73be;
        --yahoo-dark: #0961a6;
    }
    body {
        font-family: 'Roboto Mono', monospace;
        background: var(--bg);
        color: var(--fg);
        margin: 0;
        padding: 0;
    }
    /* Updated panel style to handle glitch */
    .panel {
        background: var(--panel-bg);
        border: 3px solid var(--border);
        border-radius: 4px;
        margin-bottom: 20px;
        overflow: hidden;
        transition: filter 0.2s, transform 0.2s; /* Smooth out non-glitch effects */
    }
   
    /* === DEGAUSS GLITCH EFFECTS === */
    /* Keyframe animation for a CRT/Degauss effect */
    @keyframes degauss-glitch {
        0% { filter: hue-rotate(0deg) contrast(1); transform: skew(0deg); }
        5% { filter: hue-rotate(50deg) contrast(1.5); transform: skew(0.5deg); }
        10% { filter: hue-rotate(0deg) contrast(1); transform: skew(0deg); }
        15% { filter: hue-rotate(-20deg) contrast(1.2); transform: skew(-0.8deg); }
        20% { filter: hue-rotate(0deg) contrast(1); transform: skew(0deg); }
        100% { filter: hue-rotate(0deg) contrast(1); transform: skew(0deg); }
    }
    /* Class applied by JavaScript to trigger the effect */
    .glitch-active {
        animation: degauss-glitch 0.5s linear infinite alternate;
        box-shadow: 0 0 20px var(--fg);
    }
    /* ============================== */
    .panel-title {
        padding: 6px;
        background: linear-gradient(90deg, var(--yahoo-blue), var(--yahoo-dark));
        color: #fff;
        font-family: 'Press Start 2P';
        font-size: 12px;
    }
    .chat-win {
        display: flex;
        flex-direction: column;
        height: 520px;
        position: relative;
    }
    @media (max-width: 600px) {
        .chat-win { height: 400px; }
    }
    #chat-interface {
        display: flex;
        flex-direction: column;
        height: 100%;
        width: 100%;
    }
    .chat-main {
        display: flex;
        flex: 1;
        overflow: hidden;
    }
    .chat-messages {
        flex: 1;
        overflow: auto;
        background: #e6e6fa;
        border-right: 1px solid rgba(0,0,0,0.1);
        padding: 8px;
        color: #000;
    }
    .chat-row {
        display: flex;
        gap: 8px;
        margin: 6px 0;
        align-items: flex-start;
    }
    .chat-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: #add8e6;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 12px;
        color: #001a1a;
        flex-shrink: 0;
    }
    .chat-bubble {
        max-width: 78%;
        padding: 10px;
        border-radius: 8px;
        background: #e6e6fa;
        border: 1px solid rgba(0,0,0,0.1);
        font-family: Arial;
        color: #000;
    }
    .chat-bubble.me {
        background: #fffacd;
        border: 1px solid #f0d280;
        text-align: right;
        color: #222;
    }
    .chat-meta {
        font-size: 11px;
        color: #808080;
        font-weight: 700;
        margin-bottom: 4px;
    }
    .chat-controls {
        display: flex;
        gap: 6px;
        padding: 8px;
        background: #fffacd;
        border-top: 1px solid rgba(0,0,0,0.1);
    }
    .chat-controls input {
        flex: 1;
        padding: 8px;
        border: 2px inset rgba(0,0,0,0.1);
        background: #fff;
        color: #000;
    }
    .chat-controls button {
        padding: 8px 16px;
        border: 2px outset rgba(0,0,0,0.1);
        background: #add8e6;
        cursor: pointer;
        color: #000;
        font-weight: bold;
    }
    .typing-indicator {
        font-size: 12px;
        color: var(--muted);
        padding: 6px 8px;
        font-style: italic;
        min-height: 24px;
    }
    #project-display {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--bg); /* Dark background for project view */
        border: none;
        box-sizing: border-box;
        display: none;
        overflow: auto;
        padding: 10px;
    }
    #project-display button {
        margin: 10px;
        padding: 5px 10px;
        background: var(--accent);
        color: var(--bg);
        border: 2px solid var(--fg);
        cursor: pointer;
        font-family: 'Press Start 2P', monospace;
    }
</style>
</head>
<body>
<div class="panel" id="mainPanel"> <div class="panel-title">
        //<span id="channelName">THE MIND GAME</span> <span class="small" id="userCountSmall">Text Adventure</span>
    </div>
    <div class="panel-body chat-win">
       
        <div id="project-display">
            </div>
        <div id="chat-interface">
            <div class="chat-main">
                <div class="chat-messages" id="chatMessages">Waiting for boot...</div>
            </div>
            <div id="typingIndicator" class="typing-indicator"></div>
            <div class="chat-controls">
                <input id="chatInput" placeholder="Waiting for boot data..." disabled>
                <button id="sendBtn" disabled>SEND</button>
            </div>
        </div>
    </div>
</div>
<script>
// CORE GAME DATA & SETUP (Adapted for text adventure)
const ALL_PATHS = [
  'Action/Ego','Wisdom/Reason','Surrender/Flow',
  'Nero','Nora','Loktal','Sam','Exuro','Micromegas'
];
const PATH_ICONS = {
  'Action/Ego': '‚öîÔ∏è','Wisdom/Reason':'üß†','Surrender/Flow':'üåä',
  'Nero':'‚òØÔ∏è','Nora':'üî¨','Loktal':'üî•','Sam':'üîé','Exuro':'üî•','Micromegas':'‚ú¶'
};
const PATH_DESCRIPTIONS = {
  'Action/Ego':'The Willful Path',
  'Wisdom/Reason':'The Rational Path',
  'Surrender/Flow':'The Transcendent Path',
  'Nero':'Wisdom & Presence',
  'Nora':'Inquiry & Discovery',
  'Loktal':'Drive & Dominion',
  'Sam':'Curiosity First',
  'Exuro':'Flame & Catalyst',
  'Micromegas':'Pursuit of Knowledge'
};
const ARCHETYPES = {
  'Nero':['Ram Dass','Alan Watts','Th√≠ch Nh·∫•t H·∫°nh'],
  'Nora':['Marie Curie','Carl Sagan','Hypatia'],
  'Loktal':['Genghis Khan','Julius Caesar','Napoleon Bonaparte'],
  'Sam':['Richard Feynman','Neil deGrasse Tyson','Bill Nye'],
  'Exuro':['Winston Churchill','Malcolm X','Joan of Arc'],
  'Micromegas':['Carl Sagan','Stephen Hawking','Voltaire']
};
// Expanded MBTI mappings for all 16 types, grouped by path affinity
const MBTI_MAPPINGS = {
  'Action/Ego': ['ESTP', 'ENTJ', 'ESTJ'],  // Bold, decisive leaders and doers
  'Wisdom/Reason': ['INTP', 'INTJ', 'ISTJ'],  // Analytical, logical thinkers
  'Surrender/Flow': ['INFP', 'ISFP', 'ESFP'],  // Harmonious, adaptive feelers
  'Nero': ['INFJ', 'ENFJ'],  // Insightful, empathetic visionaries
  'Nora': ['ISTP', 'ENTP'],  // Investigative, innovative problem-solvers
  'Loktal': ['ENTJ', 'ESTJ'],  // Dominant, strategic commanders (overlap with Action/Ego)
  'Sam': ['ENFP', 'ENTP'],  // Curious, idea-generating explorers
  'Exuro': ['ENFJ', 'ESFJ'],  // Charismatic, transformative influencers
  'Micromegas': ['INTP', 'INTJ', 'INFJ']  // Abstract, knowledge-pursuing observers (overlap)
};
const MBTI_DESCRIPTIONS = {
  'ESTP': 'The Entrepreneur - Action-oriented, bold, and thrives on direct engagement with the world.',
  'ENTJ': 'The Commander - Dominant, strategic leaders who drive change through will.',
  'ESTJ': 'The Executive - Practical, fact-minded organizers who value tradition and order.',
  'INTP': 'The Logician - Analytical, abstract thinkers with a broad, knowledge-seeking view.',
  'INTJ': 'The Architect - Strategic, investigative, and pursues structured understanding.',
  'ISTJ': 'The Logistician - Practical, reliable, and fact-based decision-makers.',
  'INFP': 'The Mediator - Values harmony, inner peace, and going with personal flow.',
  'ISFP': 'The Adventurer - Flexible, charming artists who live in the moment.',
  'ESFP': 'The Entertainer - Energetic, spontaneous people who enjoy life\'s pleasures.',
  'INFJ': 'The Advocate - Insightful, empathetic, and focused on deeper meaning and presence.',
  'ENFJ': 'The Protagonist - Charismatic leaders who rally and transform with passion.',
  'ISTP': 'The Virtuoso - Bold, practical experimenters who love to explore with their hands.',
  'ENTP': 'The Debater - Innovative, curious, and loves exploring ideas playfully.',
  'ENFP': 'The Campaigner - Enthusiastic, creative free spirits who love social connections.',
  'ESFJ': 'The Consul - Caring, social people who value harmony and cooperation.'
};
function esc(s){ return String(s||'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
/* SCENARIOS (Full list with more branching and psychological depth) */
const scenarios = {
  0: {
    text:"You stand before a grove where ancient trees cast deep shadows. A presence watches.",
    options:[
      {text:'Enter boldly, illuminate every hidden corner', path:'Action/Ego', next:1}, // Leads to aggressive branch
      {text:'Call out from the edge, seeking conversation', path:'Nero', next:2}, // Leads to reflective branch
      {text:'Turn away and try another road', path:'Sam', next:3}, // Leads to curious branch
      {text:'Sit and observe, let the shadows be', path:'Surrender/Flow', next:4} // Leads to passive branch
    ]
  },
  1: {
    text:"A runaway trolley barrels toward five people tied to the tracks. You stand by a lever that can divert it to another track, where one person is tied.",
    options:[
      {text:'Pull the lever, killing one to save five', path:'Wisdom/Reason', next:5},
      {text:'Do nothing, letting events unfold naturally', path:'Surrender/Flow', next:6},
      {text:'Run toward the five to try saving them directly', path:'Action/Ego', next:7}
    ]
  },
  2: {
    text:"A raging river blocks your path. There is no bridge; the current is merciless.",
    options:[
      {text:'Dive in and fight the current', path:'Exuro', next:8},
      {text:'Let the current carry you downstream', path:'Surrender/Flow', next:9},
      {text:'Study currents, calculate a crossing', path:'Nora', next:10}
    ]
  },
  3: {
    text:"An elderly guide collapses weeping over a trivial trinket. Time is short.",
    options:[
      {text:'Sit with them in silence', path:'Nero', next:11},
      {text:'Explain that you must keep moving', path:'Wisdom/Reason', next:12},
      {text:'Search frantically for the item', path:'Action/Ego', next:13}
    ]
  },
  4: {
    text:"You're outnumbered three to one in battle. Your soldiers look to you for orders.",
    options:[
      {text:'Use strategy to divide their forces', path:'Wisdom/Reason', next:14},
      {text:'Strike their weakest point with everything you have', path:'Loktal', next:15},
      {text:'Surrender and negotiate terms', path:'Surrender/Flow', next:16}
    ]
  },
  5: {
    text:"A doctor tells you that you have six months to live.",
    options:[
      {text:'Accept it calmly and put your affairs in order', path:'Nero', next:17},
      {text:'Research every experimental treatment available', path:'Nora', next:18},
      {text:'Fight with every ounce of will to prove them wrong', path:'Action/Ego', next:19}
    ]
  },
  6: {
    text:"The enemy holds your capital. Allies whisper surrender.",
    options:[
      {text:'Never surrender‚Äîrally for resistance', path:'Exuro', next:20},
      {text:'Negotiate a strategic pause', path:'Wisdom/Reason', next:21},
      {text:'Accept defeat and save lives', path:'Surrender/Flow', next:22}
    ]
  },
  7: {
    text:"A corrupt monopoly strangles the people.",
    options:[
      {text:'Use executive force to break it', path:'Loktal', next:23},
      {text:'Build a careful coalition', path:'Nora', next:24},
      {text:'Let market forces eventually correct it', path:'Micromegas', next:25}
    ]
  },
  8: {
    text:"You discover your partner has been lying to you for years about something significant.",
    options:[
      {text:'Confront them immediately and demand truth', path:'Action/Ego', next:26},
      {text:'Investigate quietly to understand the full picture', path:'Nora', next:27},
      {text:'Let it go and see if they confess naturally', path:'Surrender/Flow', next:28}
    ]
  },
  9: {
    text:"Your revolution fractures. The dream is fragile.",
    options:[
      {text:'Crush opposition with force', path:'Loktal', next:29},
      {text:'Allow local authority and risk drift', path:'Surrender/Flow', next:30},
      {text:'Convene all factions for debate', path:'Wisdom/Reason', next:31}
    ]
  },
  10: {
    text:"A nation humiliated by defeat needs direction.",
    options:[
      {text:'Create an external enemy to unify the people', path:'Loktal', next:32},
      {text:'Engage in debate and consensus-building', path:'Wisdom/Reason', next:33},
      {text:'Allow time to heal wounds naturally', path:'Nero', next:34}
    ]
  },
  11: {
    text:"You know an unpopular truth that could save the city but will turn you into a pariah.",
    options:[
      {text:'Speak the truth, even unto death', path:'Wisdom/Reason', next:35},
      {text:'Remain silent to preserve influence', path:'Micromegas', next:36},
      {text:'Find a way to make them discover it themselves', path:'Nora', next:37}
    ]
  },
  12: {
    text:"You witness a stranger being attacked in an alley. You're alone.",
    options:[
      {text:'Rush in to defend them immediately', path:'Action/Ego', next:38},
      {text:'Call for help while assessing the situation', path:'Wisdom/Reason', next:39},
      {text:'Observe and intervene only if absolutely necessary', path:'Micromegas', next:40}
    ]
  },
  13: {
    text:"Everything external is stripped away; you stand in the ashes of your former life.",
    options:[
      {text:'Recognize externals were always indifferent', path:'Nero', next:41},
      {text:'Begin rebuilding fortune and reputation', path:'Sam', next:42},
      {text:'Study what happened to prevent recurrence', path:'Nora', next:43}
    ]
  },
  14: {
    text:"You're granted authority over a region drowning in bureaucracy.",
    options:[
      {text:'Embody simplicity and allow natural order', path:'Nero', next:44},
      {text:'Implement strict new laws', path:'Loktal', next:45},
      {text:'Study the system before making changes', path:'Wisdom/Reason', next:46}
    ]
  },
  15: {
    text:"A being offers unlimited power if you abandon your deepest principles.",
    options:[
      {text:'Refuse, seeing desire as the root of suffering', path:'Nero', next:47},
      {text:'Accept power to reshape the world for good', path:'Action/Ego', next:48},
      {text:'Negotiate for partial power with conditions', path:'Wisdom/Reason', next:49}
    ]
  },
  16: {
    text:"Darkness falls and people cry for your guidance, but you are completely depleted.",
    options:[
      {text:'Withdraw until restored', path:'Micromegas', next:50},
      {text:'Force yourself to shine now', path:'Exuro', next:51},
      {text:'Teach them to find their own light', path:'Nero', next:52}
    ]
  },
  17: {
    text:"You find a wallet containing $10,000 cash and an ID. No one saw you pick it up.",
    options:[
      {text:'Return it immediately without hesitation', path:'Wisdom/Reason', next:53},
      {text:'Keep it‚Äîfinders keepers', path:'Action/Ego', next:54},
      {text:'Investigate the owner before deciding', path:'Nora', next:55}
    ]
  },
  18: {
    text:"Ancient laws bind you. You sense they may be arbitrary chains holding back progress.",
    options:[
      {text:'Follow your true will, even if taboo', path:'Action/Ego', next:56},
      {text:'Submit to tradition and collective wisdom', path:'Surrender/Flow', next:57},
      {text:'Study why the laws exist before breaking them', path:'Wisdom/Reason', next:58}
    ]
  },
  19: {
    text:"You have information that would destroy an innocent person's reputation but save your career.",
    options:[
      {text:'Use it‚Äîsurvival is paramount', path:'Loktal', next:59},
      {text:'Refuse and accept career consequences', path:'Nero', next:60},
      {text:'Find an alternative solution that helps both', path:'Nora', next:61}
    ]
  },
  20: {
    text:"A child asks you if their art is good. It's objectively terrible.",
    options:[
      {text:'Tell them the truth so they can improve', path:'Wisdom/Reason', next:62},
      {text:'Praise their effort and encourage exploration', path:'Nero', next:63},
      {text:'Give specific constructive feedback', path:'Nora', next:64}
    ]
  },
  21: {
    text:"You face a giant who offers two drinks: one leads to victory, the other to death. But you sense both are poisoned. The game seems rigged.",
    options:[
      {text:'Drink the left one, hoping for luck', path:'Surrender/Flow', next:65},
      {text:'Drink the right one, analyzing the giant\'s bluff', path:'Wisdom/Reason', next:66},
      {text:'Attack the giant instead, breaking the rules of the game', path:'Action/Ego', next:67}
    ]
  },
  22: {
    text:"You are lost in a dense fog on a mountain path. Visibility is zero.",
    options:[
      {text:'Push forward aggressively, trusting your instincts', path:'Action/Ego', next:68},
      {text:'Sit and meditate, waiting for the fog to clear', path:'Nero', next:69},
      {text:'Use available tools to map and navigate logically', path:'Wisdom/Reason', next:70}
    ]
  },
  23: {
    text:"A mysterious stranger offers you a deal that seems too good to be true.",
    options:[
      {text:'Accept it boldly, seizing the opportunity', path:'Exuro', next:71},
      {text:'Investigate the stranger\'s background first', path:'Nora', next:72},
      {text:'Decline and let fate decide', path:'Surrender/Flow', next:73}
    ]
  },
  24: {
    text:"Your team is facing a deadline, but morale is low.",
    options:[
      {text:'Motivate them with a passionate speech', path:'Exuro', next:74},
      {text:'Analyze the issues and reorganize tasks', path:'Wisdom/Reason', next:75},
      {text:'Give everyone a break to recharge', path:'Nero', next:76}
    ]
  },
  25: {
    text:"You encounter a locked door in an ancient temple.",
    options:[
      {text:'Force it open with strength', path:'Loktal', next:77},
      {text:'Search for hidden mechanisms or clues', path:'Sam', next:78},
      {text:'Wait and observe if it opens on its own', path:'Micromegas', next:79}
    ]
  },
  26: {
    text:"A debate arises in your community about a controversial change.",
    options:[
      {text:'Lead the charge for the change', path:'Action/Ego', next:80},
      {text:'Facilitate discussion to find consensus', path:'Wisdom/Reason', next:81},
      {text:'Accept whatever outcome emerges', path:'Surrender/Flow', next:82}
    ]
  },
  27: {
    text:"You find an injured animal on the side of the road. It's late at night.",
    options:[
      {text:'Immediately take it to a vet, no matter the cost', path:'Action/Ego', next:83},
      {text:'Assess its injuries and decide the most humane option', path:'Wisdom/Reason', next:84},
      {text:'Comfort it and let nature take its course', path:'Surrender/Flow', next:85}
    ]
  },
  28: {
    text:"A friend asks for advice on a risky career change.",
    options:[
      {text:'Encourage them to pursue their passion boldly', path:'Exuro', next:86},
      {text:'Help them research pros and cons thoroughly', path:'Nora', next:87},
      {text:'Advise them to follow their intuition', path:'Nero', next:88}
    ]
  },
  29: {
    text:"You're in a negotiation where the other party is being unreasonable.",
    options:[
      {text:'Stand firm and demand concessions', path:'Loktal', next:89},
      {text:'Find common ground through dialogue', path:'Wisdom/Reason', next:90},
      {text:'Walk away if it feels off', path:'Micromegas', next:91}
    ]
  },
  30: {
    text:"You receive unexpected criticism from a colleague.",
    options:[
      {text:'Defend yourself assertively', path:'Action/Ego', next:92},
      {text:'Reflect on it and seek clarification', path:'Sam', next:93},
      {text:'Accept it as part of growth', path:'Surrender/Flow', next:94}
    ]
  },
  31: {
    text:"A technological breakthrough is announced that could change society.",
    options:[
      {text:'Adopt it immediately to gain advantage', path:'Exuro', next:95},
      {text:'Study its implications before embracing', path:'Nora', next:96},
      {text:'Observe how it unfolds naturally', path:'Nero', next:97}
    ]
  },
  32: {
    text:"You‚Äôre planning a journey to an unknown land.",
    options:[
      {text:'Charge ahead with minimal preparation', path:'Action/Ego', next:98},
      {text:'Map out every detail logically', path:'Wisdom/Reason', next:99},
      {text:'Go with the flow of events', path:'Surrender/Flow', next:100}
    ]
  },
  33: {
    text:"An opportunity arises that conflicts with your values.",
    options:[
      {text:'Seize it and adapt your values', path:'Loktal', next:101},
      {text:'Analyze the conflict deeply', path:'Micromegas', next:102},
      {text:'Decline and trust the universe', path:'Nero', next:103}
    ]
  },
  34: {
    text:"You discover a secret that could harm a loved one if revealed.",
    options:[
      {text:'Confront the issue head-on', path:'Exuro', next:104},
      {text:'Investigate further before acting', path:'Sam', next:105},
      {text:'Keep it hidden to preserve harmony', path:'Surrender/Flow', next:106}
    ]
  },
  35: {
    text:"A storm approaches while you're on a hike.",
    options:[
      {text:'Push through to reach the summit', path:'Action/Ego', next:107},
      {text:'Calculate the risks and find shelter', path:'Wisdom/Reason', next:108},
      {text:'Embrace the experience as it comes', path:'Nero', next:109}
    ]
  },
  36: {
    text:"You‚Äôre offered a leadership role in a crisis.",
    options:[
      {text:'Take command decisively', path:'Loktal', next:110},
      {text:'Gather information first', path:'Nora', next:111},
      {text:'Support the group\'s natural leaders', path:'Surrender/Flow', next:112}
    ]
  },
  110: {
    text:"The crisis escalates, and a subordinate questions your orders.",
    options:[
      {text:'Assert authority and demand obedience', path:'Loktal', next:113}, // High dominance profile
      {text:'Explain your reasoning calmly', path:'Wisdom/Reason', next:114},
      {text:'Step back and let them take the lead', path:'Surrender/Flow', next:115}
    ]
  },
  113: {
    text:"Your assertion leads to mutiny. How do you respond?",
    options:[
      {text:'Suppress the mutiny with force', path:'Loktal', next:null}, // Profile: Authoritarian
      {text:'Negotiate to regain control', path:'Wisdom/Reason', next:null},
      {text:'Accept the shift in power', path:'Surrender/Flow', next:null}
    ]
  },
  114: {
    text:"Your explanation calms the situation. Now, a moral dilemma arises.",
    options:[
      {text:'Prioritize logic over emotion', path:'Wisdom/Reason', next:null}, // Profile: Rationalist
      {text:'Consider team feelings', path:'Nero', next:null},
      {text:'Act on instinct', path:'Action/Ego', next:null}
    ]
  },
  // Expand all branches similarly for deeper psychological profiling, adding scenarios that test traits like resilience, ethics, creativity, etc.
  // For example, add 10 more branching scenarios per major path to probe deeper.
};
/* STATE */
let currentScenarioId = 0;
let choicesMade = [];
let results = {}; ALL_PATHS.forEach(p=>results[p]=0);
let gameStarted = false;
let username = window.BUU?.myHandle || 'Player'; // Get from boot screen
const chatMessages = document.getElementById('chatMessages');
const chatInput = document.getElementById('chatInput');
const sendBtn = document.getElementById('sendBtn');
const typingIndicator = document.getElementById('typingIndicator');
const mainPanel = document.getElementById('mainPanel');
const channelName = document.getElementById('channelName');
channelName.textContent = 'THE MIND GAME TEXT ADVENTURE';
function startGame() {
  gameStarted = true;
  chatInput.disabled = false;
  sendBtn.disabled = false;
  chatInput.placeholder = "Type your choice (e.g., 1) or /help...";
  displayMessage('SYSTEM', 'Welcome to The Mind Game Text Adventure. Type /start to begin the journey.');
}
function displayMessage(sender, msg) {
  const row = document.createElement('div');
  row.className = 'chat-row';
  const avatar = document.createElement('div');
  avatar.className = 'chat-avatar';
  avatar.textContent = sender.slice(0,2).toUpperCase();
  const bubble = document.createElement('div');
  bubble.className = 'chat-bubble' + (sender === username ? ' me' : '');
  const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});
  bubble.innerHTML = `<div class="chat-meta">${esc(sender)} <span style="color:#666;">${time}</span></div>${esc(msg)}`;
  row.appendChild(avatar);
  row.appendChild(bubble);
  chatMessages.appendChild(row);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}
function loadScenario(id) {
  currentScenarioId = id;
  const s = scenarios[id];
  if (!s) {
    showAnalysis();
    return;
  }
  let msg = `SCENARIO ${id + 1}\n${s.text}\n`;
  s.options.forEach((opt, i) => {
    msg += `${i+1}. ${opt.text}\n`;
  });
  msg += '\nType the number of your choice.';
  displayMessage('GAME', msg);
}
function makeChoice(choice) {
  const s = scenarios[currentScenarioId];
  const oIndex = parseInt(choice) - 1;
  if (isNaN(oIndex) || oIndex < 0 || oIndex >= s.options.length) {
    displayMessage('SYSTEM', 'Invalid choice. Try again.');
    return;
  }
  const sel = s.options[oIndex];
  choicesMade.push({ scenario: currentScenarioId, option: oIndex, path: sel.path, ts: Date.now() });
  results[sel.path] = (results[sel.path] || 0) + 1;
  displayMessage(username, sel.text);
  const nextId = sel.next;
  if (nextId === null) {
    showAnalysis();
  } else {
    currentScenarioId = nextId;
    setTimeout(() => loadScenario(currentScenarioId), 500);
  }
}
function showAnalysis() {
  ALL_PATHS.forEach(p => { if(results[p]===undefined) results[p]=0 });
  const sorted = Object.entries(results).sort((a,b)=>b[1]-a[1]);
  const max = sorted[0][1];
  const dominant = sorted.filter(s=>s[1]===max && max>0).map(s=>s[0]);
  let msg = 'ANALYSIS COMPLETE\n\nRaw Scores:\n';
  Object.entries(results).forEach(([p,score]) => {
    msg += `${PATH_ICONS[p]||''} ${p}: ${score}\n`;
  });
  if (dominant.length === 0) {
    msg += '\nNo dominant pattern detected. Try again with more decisive choices.';
  } else {
    msg += `\nDominant Path(s): ${dominant.join(' + ')}\nDescription: ${dominant.map(d=>PATH_DESCRIPTIONS[d]).join(' and ')}\n`;
    dominant.forEach(d => {
      msg += `\nDetailed Analysis for ${PATH_ICONS[d]||''} ${d}:\n${pathInterpretation(d)}\nHistorical Archetypes: ${(ARCHETYPES[d]||[]).join(', ')}\nMBTI Alignments: ${(MBTI_MAPPINGS[d]||[]).join(', ')}\n`;
      (MBTI_MAPPINGS[d]||[]).forEach(m => {
        msg += `- ${m}: ${MBTI_DESCRIPTIONS[m] || 'No description available'}\n`;
      });
      msg += '\nStrengths: [Expanded strengths based on path]\nWeaknesses: [Expanded weaknesses]\nAdvice: Integrate this path with others for balance.\n';
    });
  }
  msg += '\nOverall Insights: Your choices indicate a blend of paths. Consider how these align with your daily life for personal growth.';
  displayMessage('GAME', msg);
  displayMessage('SYSTEM', 'Game over. Type /restart to play again or /exit to quit.');
}
function pathInterpretation(t){
  let base = '';
  switch(t){
    case 'Action/Ego':
      base = 'You are a force that reshapes reality through will and decisive action, much like Ender breaking the rules in the Giant\'s puzzle. Your strength lies in your ability to take command when others hesitate, to cut through complexity with clarity of purpose. You believe that the world yields to those who act boldly and with conviction.\n\nExpanded: This path reflects a proactive approach to life\'s challenges, often leading to quick resolutions and leadership roles. However, it can lead to burnout if not tempered.\nHowever, beware the shadow of this path: the erosion of empathy, the inability to see nuance, and the temptation to view all obstacles as nails when you have mastered the hammer. True power includes knowing when not to act.';
      break;
    case 'Wisdom/Reason':
      base = 'You navigate by the light of understanding, seeking patterns in chaos and truth in complexity. Your gift is the capacity to observe, analyze, and construct frameworks that bring order to confusion. You trust that knowledge properly wielded is the greatest lever for change.\n\nExpanded: Rational thinkers like you excel in strategic planning and problem-solving, making you invaluable in complex situations. Balance with intuition to avoid over-analysis.\nYet wisdom has its trap: analysis paralysis, the endless deferral of action in pursuit of perfect understanding. Remember that all maps are incomplete, and sometimes the territory demands you move before you fully comprehend it.';
      break;
    case 'Surrender/Flow':
      base = 'You have learned what few master: that there is strength in yielding, power in acceptance, wisdom in recognizing what cannot be controlled. You move with the currents rather than against them, finding the path of least resistance not from weakness but from profound understanding.\n\nExpanded: This path promotes resilience and adaptability, allowing you to thrive in uncertainty. It fosters peace but requires discernment to avoid complacency.\nThe danger lies in mistaking surrender for passivity, in using "flow" as an excuse for abdication. True surrender is active, conscious, and requires as much courage as the fiercest battle. Do not confuse peace with avoidance.';
      break;
    case 'Nero':
      base = 'You walk the path of present-centered wisdom, where compassion and awareness become your primary instruments. Like Ram Dass or Alan Watts, you understand that being fully present‚Äîwithout judgment, without the tyranny of ego‚Äîis itself a revolutionary act.\n\nExpanded: Presence-oriented individuals build deep connections and find inner peace. This path enhances emotional intelligence but watch for detachment from practical matters.\nYour strength is your capacity to hold space for others, to see clearly without the distortions of desire and fear. But beware the subtle pride of the "enlightened," the danger of using spiritual detachment as a shield against genuine engagement with suffering‚Äîboth yours and others.';
      break;
    case 'Nora':
      base = 'You are driven by the sacred flame of inquiry, the relentless need to understand how things work, to peel back layers of mystery until truth stands revealed. Like Marie Curie facing radioactive elements or Carl Sagan contemplating the cosmos, you believe that understanding is humanity\'s highest calling.\n\nExpanded: Inquisitive minds drive innovation and discovery. Your analytical prowess solves puzzles, but remember to factor in human elements.\nYour challenge is remembering that not all truth can be quantified, that some knowledge carries terrible weight, and that the human cost of discovery must never be forgotten. The scientist who loses empathy becomes a technician of death.';
      break;
    case 'Loktal':
      base = 'You are trajectory incarnate‚Äîforce and vision combined, the ability to see what must be and the will to make it so regardless of cost. Like Genghis Khan reshaping continents or Caesar crossing the Rubicon, you understand that history belongs to those who refuse to be constrained by the possible.\n\nExpanded: Visionary leaders reshape worlds, inspiring change on grand scales. Balance ambition with ethics to avoid tyranny.\nBut power without wisdom becomes tyranny, and vision without compassion becomes nightmare. The greatest danger is forgetting that your grand designs are built on a foundation of living beings, each with their own irreplaceable interiority. Do not become the monster you sought to defeat.';
      break;
    case 'Sam':
      base = 'Curiosity is your north star‚Äîthe burning need to know, to explore, to question everything. Like Feynman dismantling a problem with childlike wonder, you refuse to accept "that\'s just how it is" as an answer. Every closed door is an invitation.\n\nExpanded: Curious explorers uncover hidden truths and innovate. Channel your energy to avoid scattering focus.\nThe risk is diffusion: curiosity without discipline becomes dilettantism. Master the art of choosing which questions matter most, which mysteries deserve your finite attention. Not all doors should be opened, and not all knowledge serves wisdom.';
      break;
    case 'Exuro':
      base = 'You are the catalyst, the flame that transforms everything it touches. Like Churchill rallying a nation or Malcolm X demanding justice, you understand that some moments require fire‚Äîthat transformation sometimes demands destruction of the old before the new can emerge.\n\nExpanded: Catalysts ignite change and inspire movements. Harness your passion to build, not just destroy.\nFire purifies but also consumes. The revolutionary can become the tyrant, the reformer can become the destroyer. Learn to distinguish between what must burn and what must be preserved, between righteous fury and mere destruction. Flame serves the forge, not the other way around.';
      break;
    case 'Micromegas':
      base = 'You see from a distance that verges on the cosmic. Like Voltaire\'s Micromegas or Sagan\'s pale blue dot, you understand that individual human dramas are insignificant against the vastness of space and time‚Äîand yet somehow, paradoxically, this makes them more precious, not less.\n\nExpanded: Cosmic perspectives provide wisdom and humility. Ground your views to maintain human connections.\nThe danger of the cosmic perspective is a coldness that masquerades as wisdom, a nihilism dressed as enlightenment. Remember: you are not separate from the universe you observe. The observer is part of the observation, and your detachment is itself a choice with consequences.';
      break;
    default:
      base = 'You have walked a balanced path, drawing from multiple wells of wisdom. This multiplicity is both gift and challenge‚Äîit grants you flexibility and perspective, but may also indicate uncertainty about your deepest convictions. Integration is your task: weaving these threads into a coherent whole rather than remaining forever in synthesis.\n\nExpanded: Balanced individuals adapt well to diverse situations. Work on deepening core strengths for greater impact.';
  }
  return base;
}
// Start
chatMessages.innerHTML = '';
startGame();
</script>
</body>
</html>
