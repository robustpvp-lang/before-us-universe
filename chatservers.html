<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Before Us Universe â€” Chat Servers</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
    body { font-family: 'Roboto Mono', monospace; background: #000; color: #fff; margin:0; padding:0; }
    #servers, #dms { display: flex; flex-direction: column; padding: 10px; max-width: 300px; }
    .server, .dm { padding: 8px; margin: 4px 0; background: #111; cursor: pointer; border-radius: 4px; }
    .chat-window { position: fixed; right: 10px; bottom: 10px; width: 300px; height: 400px; background: #222; display: flex; flex-direction: column; border: 1px solid #555; border-radius: 6px; }
    .chat-messages { flex: 1; overflow-y: auto; padding: 5px; }
    .chat-input { display: flex; }
    .chat-input input { flex: 1; padding: 5px; background: #111; border: none; color: #fff; }
    .chat-input button { padding: 5px; background: #333; color: #fff; border: none; cursor: pointer; }
</style>
</head>
<body>
<h1>BUU Chat Servers</h1>
<div id="servers">
    <h3>Servers</h3>
</div>
<div id="dms">
    <h3>Direct Messages</h3>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded, remove, set } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";

// Firebase config
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_DOMAIN",
    databaseURL: "YOUR_DB_URL",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_BUCKET",
    messagingSenderId: "YOUR_SENDER",
    appId: "YOUR_APP_ID"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Dummy user/session
const uid = "user123";
const username = "Commander";

// Sample servers and users
const servers = ["Alpha", "Beta", "Gamma"];
const users = ["Sam", "Nora", "Don", "Maria"];

// Populate server list
const serverDiv = document.getElementById("servers");
servers.forEach(server => {
    const el = document.createElement("div");
    el.className = "server";
    el.textContent = server;
    el.addEventListener("click", () => openServerChat(server));
    serverDiv.appendChild(el);
});

// Populate DM list
const dmDiv = document.getElementById("dms");
users.forEach(user => {
    if(user === username) return; // Skip self
    const el = document.createElement("div");
    el.className = "dm";
    el.textContent = user;
    el.addEventListener("click", () => openDM(user));
    dmDiv.appendChild(el);
});

// Open server chat
function openServerChat(serverName) {
    openChatWindow(`server-${serverName}`, `Server: ${serverName}`, ref(db, `servers/${serverName}`));
}

// Open DM
function openDM(user) {
    const path = [uid, user].sort().join("_"); // consistent key
    openChatWindow(`dm-${user}`, `DM: ${user}`, ref(db, `dms/${path}`));
}

// Create chat window
function openChatWindow(id, title, dbRef) {
    if(document.getElementById(id)) return; // already open

    const chatWin = document.createElement("div");
    chatWin.className = "chat-window";
    chatWin.id = id;

    const header = document.createElement("div");
    header.textContent = title;
    header.style.background = "#333";
    header.style.padding = "5px";
    chatWin.appendChild(header);

    const messages = document.createElement("div");
    messages.className = "chat-messages";
    chatWin.appendChild(messages);

    const inputDiv = document.createElement("div");
    inputDiv.className = "chat-input";
    const input = document.createElement("input");
    input.placeholder = "Type a message...";
    const sendBtn = document.createElement("button");
    sendBtn.textContent = "Send";
    inputDiv.appendChild(input);
    inputDiv.appendChild(sendBtn);
    chatWin.appendChild(inputDiv);
    document.body.appendChild(chatWin);

    // Send message
    sendBtn.addEventListener("click", () => {
        if(input.value.trim() === "") return;
        push(dbRef, { user: username, text: input.value.trim(), timestamp: Date.now() });
        input.value = "";
    });

    // Load messages
    onChildAdded(dbRef, (snapshot) => {
        const msg = snapshot.val();
        const msgDiv = document.createElement("div");
        msgDiv.textContent = `${msg.user}: ${msg.text}`;
        messages.appendChild(msgDiv);
        messages.scrollTop = messages.scrollHeight;
    });
}
</script>
</body>
</html>
