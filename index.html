<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Before Us Universe</title>
<style>
/* === GLOBAL THEME === */
body {
  margin: 0;
  background: black;
  color: #00ffee;
  font-family: monospace;
  overflow: hidden;
}
.hidden { display: none; }

/* === BOOT SEQUENCE === */
#boot-screen {
  position: fixed;
  inset: 0;
  background: black;
  display: flex;
  justify-content: center;
  align-items: center;
  color: #00ffee;
  font-size: 2rem;
  animation: fadeOut 5s forwards 5s;
}
@keyframes fadeOut {
  to { opacity: 0; visibility: hidden; }
}

/* === NTD FACE BACKGROUND === */
#ghost-layer {
  position: fixed;
  inset: 0;
  background: url("https://raw.githubusercontent.com/robustpvp-lang/before-us-universe/main/scripts/ntd-face.jpeg") center/cover no-repeat;
  mix-blend-mode: screen;
  opacity: 0;
  z-index: 0;
  animation: ghostFlash 8s infinite;
}
@keyframes ghostFlash {
  0%,100% { opacity: 0; }
  45%,55% { opacity: 0.18; }
}

/* === MAIN CONTENT === */
#main-content {
  position: relative;
  z-index: 1;
  padding: 20px;
}

/* === CHAT === */
#chat { border-top: 1px solid #00ffee44; padding-top: 10px; }
#chat-messages {
  height: 150px;
  overflow-y: auto;
  background: #001010;
  border: 1px solid #00ffee44;
  padding: 10px;
  margin-bottom: 8px;
}
.chat-message { margin: 2px 0; }

/* === BOARD === */
#board-posts {
  border: 1px solid #00ffee44;
  background: #001010;
  padding: 10px;
  margin-top: 10px;
  max-height: 200px;
  overflow-y: auto;
}
</style>
</head>
<body>

<!-- Boot Screen -->
<div id="boot-screen">
  <div>█ SYSTEM BOOTING... █</div>
</div>

<!-- Main App -->
<div id="main-content" class="hidden">
  <div id="ghost-layer"></div>

  <h2>Before Us Universe</h2>
  <div id="online-count">Currently: 0</div>

  <div id="chat">
    <h3>Live Chat</h3>
    <div id="chat-messages"></div>
    <input id="chat-input" placeholder="Type message..." />
    <button onclick="sendMessage()">Send</button>
  </div>

  <div id="board">
    <h3>Message Board</h3>
    <div id="board-posts"></div>
    <input id="post-title" placeholder="Title" />
    <textarea id="post-content" placeholder="Post..."></textarea>
    <button onclick="createPost()">Post</button>
  </div>
</div>

<!-- === MAIN JS SECTION === -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getDatabase, ref, push, onValue, set, onDisconnect } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

const firebaseConfig = {
  apiKey: "AIzaSyBGdiOrMFolYWNMvckE4fbp_VhWA80BaII",
  authDomain: "before-us-universe.firebaseapp.com",
  databaseURL: "https://before-us-universe-default-rtdb.firebaseio.com",
  projectId: "before-us-universe",
  storageBucket: "before-us-universe.appspot.com",
  messagingSenderId: "477103463228",
  appId: "1:477103463228:web:01b53b6b29cb9d54315c39"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Boot-up sequence (5 sec)
window.addEventListener("load", () => {
  setTimeout(() => {
    document.getElementById("boot-screen").classList.add("hidden");
    document.getElementById("main-content").classList.remove("hidden");
    initApp();
  }, 5000);
});

let username = localStorage.getItem("buu_username") || prompt("Enter username:");
localStorage.setItem("buu_username", username);

function initApp() {
  const uid = localStorage.getItem("buu_uid") || Date.now().toString();
  localStorage.setItem("buu_uid", uid);

  const onlineRef = ref(db, "online/" + uid);
  set(onlineRef, { username, timestamp: Date.now() });
  onDisconnect(onlineRef).remove();

  const chatRef = ref(db, "chat");
  const postsRef = ref(db, "posts");

  onValue(ref(db, "online"), (snap) => {
    document.getElementById("online-count").textContent = `Currently: ${snap.numChildren()}`;
  });

  onValue(chatRef, (snap) => {
    const chatDiv = document.getElementById("chat-messages");
    chatDiv.innerHTML = "";
    snap.forEach((msg) => {
      const m = msg.val();
      const div = document.createElement("div");
      div.className = "chat-message";
      div.textContent = `${m.username}: ${m.text}`;
      chatDiv.appendChild(div);
    });
    chatDiv.scrollTop = chatDiv.scrollHeight;
  });

  onValue(postsRef, (snap) => {
    const board = document.getElementById("board-posts");
    board.innerHTML = "";
    snap.forEach((p) => {
      const post = p.val();
      const div = document.createElement("div");
      div.innerHTML = `<b>${post.title}</b><p>${post.content}</p><i>— ${post.username}</i>`;
      board.appendChild(div);
    });
  });
}

window.sendMessage = function() {
  const input = document.getElementById("chat-input");
  const text = input.value.trim();
  if (!text) return;
  push(ref(db, "chat"), { username, text, timestamp: Date.now() });
  input.value = "";
};

window.createPost = function() {
  const title = document.getElementById("post-title").value.trim();
  const content = document.getElementById("post-content").value.trim();
  if (!title || !content) return;
  push(ref(db, "posts"), { title, content, username, timestamp: Date.now() });
  document.getElementById("post-title").value = "";
  document.getElementById("post-content").value = "";
};
</script>

</body>
</html>
