<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Before Us Universe</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(180deg, #9bbc0f 0%, #8bac0f 30%, #306230 70%, #0f380f 100%);
            min-height: 100vh;
            color: #0f380f;
            padding: 16px;
            position: relative;
        }

        /* Scan lines */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.1) 0px, transparent 1px, transparent 2px, rgba(0,0,0,0.1) 3px);
            pointer-events: none;
            z-index: 100;
        }

        /* Boot Screen */
        #boot-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            position: fixed;
            inset: 0;
            z-index: 200;
            background: linear-gradient(180deg, #9bbc0f 0%, #8bac0f 50%, #306230 100%);
        }

        .boot-container {
            text-align: center;
            animation: bootPulse 0.8s infinite;
        }

        .boot-box {
            background: #0f380f;
            border: 8px solid #9bbc0f;
            border-radius: 8px;
            padding: 32px;
            box-shadow: 0 0 30px rgba(155, 188, 15, 0.5);
        }

        .boot-title {
            font-size: 48px;
            font-weight: bold;
            color: #9bbc0f;
            letter-spacing: 4px;
            text-shadow: 2px 2px 0 #0f380f, 4px 4px 0 rgba(155, 188, 15, 0.3);
        }

        .boot-subtitle {
            font-size: 14px;
            color: #8bac0f;
            margin-top: 8px;
            letter-spacing: 2px;
        }

        .loading-bar {
            width: 200px;
            height: 20px;
            background: #0f380f;
            border: 3px solid #8bac0f;
            margin: 24px auto 0;
            position: relative;
            overflow: hidden;
        }

        .loading-fill {
            height: 100%;
            background: #9bbc0f;
            width: 0%;
            animation: loadFill 4s ease-in-out forwards;
        }

        .boot-copyright {
            margin-top: 24px;
            color: #9bbc0f;
            font-size: 12px;
            letter-spacing: 1px;
        }

        @keyframes loadFill {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        @keyframes bootPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.85; }
        }

        /* Main Content */
        #main-content {
            display: none;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }

        #main-content.loaded {
            display: block;
        }

        /* Username Modal */
        #username-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 150;
            align-items: center;
            justify-content: center;
        }

        #username-modal.show {
            display: flex;
        }

        .modal-content {
            background: #0f380f;
            border: 6px solid #9bbc0f;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 0 30px rgba(155, 188, 15, 0.5);
            text-align: center;
        }

        .modal-content h2 {
            color: #9bbc0f;
            font-size: 24px;
            margin-bottom: 16px;
            letter-spacing: 2px;
        }

        .modal-content input {
            background: #306230;
            border: 3px solid #8bac0f;
            color: #c0d860;
            padding: 12px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            width: 250px;
            margin-bottom: 16px;
        }

        .modal-content button {
            background: #9bbc0f;
            border: 3px solid #0f380f;
            color: #0f380f;
            padding: 12px 24px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 2px 2px 0 rgba(15, 56, 15, 0.5);
        }

        /* Header */
        .header {
            background: #0f380f;
            border: 6px solid #9bbc0f;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 4px 4px 0 rgba(15, 56, 15, 0.5);
        }

        .header h1 {
            font-size: 32px;
            font-weight: bold;
            color: #9bbc0f;
            text-align: center;
            letter-spacing: 3px;
            text-shadow: 2px 2px 0 #306230;
        }

        .header p {
            text-align: center;
            color: #8bac0f;
            font-size: 14px;
            margin-top: 8px;
            letter-spacing: 1px;
        }

        /* Grid Layout */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        @media (min-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Message Board */
        .message-board {
            background: #0f380f;
            border: 6px solid #8bac0f;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 4px 4px 0 rgba(15, 56, 15, 0.5);
        }

        .section-title {
            font-size: 20px;
            font-weight: bold;
            color: #9bbc0f;
            margin-bottom: 12px;
            border-bottom: 3px solid #8bac0f;
            padding-bottom: 8px;
            letter-spacing: 2px;
        }

        #board-posts {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 12px;
        }

        .board-post {
            background: #306230;
            border: 3px solid #9bbc0f;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .post-title {
            color: #9bbc0f;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .post-content {
            color: #c0d860;
            font-size: 12px;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .post-meta {
            color: #8bac0f;
            font-size: 11px;
            margin-top: 4px;
        }

        .new-post-form {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .new-post-form input,
        .new-post-form textarea {
            background: #306230;
            border: 3px solid #8bac0f;
            color: #c0d860;
            padding: 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .new-post-form textarea {
            resize: vertical;
            min-height: 60px;
        }

        /* Chat Log */
        .chat-container {
            background: #0f380f;
            border: 6px solid #8bac0f;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 4px 4px 0 rgba(15, 56, 15, 0.5);
            display: flex;
            flex-direction: column;
            height: 500px;
        }

        .chat-messages {
            background: #306230;
            border: 3px solid #9bbc0f;
            padding: 8px;
            border-radius: 4px;
            flex: 1;
            overflow-y: auto;
            margin-bottom: 8px;
        }

        .chat-message {
            margin-bottom: 8px;
        }

        .chat-meta {
            color: #9bbc0f;
            font-size: 11px;
        }

        .chat-meta .username {
            font-weight: bold;
        }

        .chat-text {
            color: #c0d860;
            font-size: 12px;
            margin-left: 8px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .chat-input-area {
            display: flex;
            gap: 8px;
        }

        .chat-input {
            flex: 1;
            background: #306230;
            border: 3px solid #8bac0f;
            color: #c0d860;
            padding: 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .chat-button,
        .post-button {
            background: #9bbc0f;
            border: 3px solid #0f380f;
            color: #0f380f;
            padding: 8px 16px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 2px 2px 0 rgba(15, 56, 15, 0.5);
        }

        .chat-button:hover,
        .post-button:hover {
            background: #8bac0f;
        }

        .chat-button:active,
        .post-button:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        /* Info Boxes */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        @media (min-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr 1fr 1fr;
            }
        }

        .info-box {
            background: #0f380f;
            border: 4px solid #8bac0f;
            border-radius: 6px;
            padding: 12px;
            box-shadow: 3px 3px 0 rgba(15, 56, 15, 0.5);
        }

        .info-title {
            color: #9bbc0f;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 6px;
        }

        .info-content {
            color: #c0d860;
            font-size: 12px;
        }

        /* Footer */
        .footer {
            margin-top: 20px;
            padding: 16px;
            background: #0f380f;
            border: 4px solid #9bbc0f;
            border-radius: 8px;
            text-align: center;
            color: #8bac0f;
            font-size: 12px;
            box-shadow: 4px 4px 0 rgba(15, 56, 15, 0.5);
        }

        .footer-divider {
            margin-bottom: 8px;
        }

        .footer-copyright {
            color: #9bbc0f;
            letter-spacing: 1px;
        }

        .footer-note {
            margin-top: 4px;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <!-- Boot Screen -->
    <div id="boot-screen">
        <div class="boot-container">
            <div class="boot-box">
                <div class="boot-title">WONDERBOY</div>
                <div class="boot-subtitle">BOOT SEQUENCE...</div>
                <div class="loading-bar">
                    <div class="loading-fill"></div>
                </div>
            </div>
            <p class="boot-copyright">© 1999 The Before Us Universe</p>
        </div>
    </div>

    <!-- Username Modal -->
    <div id="username-modal">
        <div class="modal-content">
            <h2>ENTER USERNAME</h2>
            <input type="text" id="username-input" placeholder="Your handle..." maxlength="20">
            <br>
            <button onclick="setUsername()">CONNECT</button>
        </div>
    </div>

    <!-- Main Content -->
    <div id="main-content">
        <!-- Header -->
        <div class="header">
            <h1>THE BEFORE US UNIVERSE</h1>
            <p>.:. Digital Memory Archives .:.</p>
        </div>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Message Board -->
            <div class="message-board">
                <h2 class="section-title">≡ MESSAGE BOARD ≡</h2>
                
                <div id="board-posts"></div>

                <div class="new-post-form">
                    <input type="text" id="post-title" placeholder="Thread Title..." maxlength="50">
                    <textarea id="post-content" placeholder="Your message..."></textarea>
                    <button class="post-button" onclick="createPost()">POST</button>
                </div>
            </div>

            <!-- Chat Log -->
            <div class="chat-container">
                <h2 class="section-title">≡ LIVE CHAT ≡</h2>
                
                <div class="chat-messages" id="chat-messages"></div>

                <div class="chat-input-area">
                    <input type="text" id="chat-input" class="chat-input" placeholder="Type message...">
                    <button onclick="sendMessage()" class="chat-button">SEND</button>
                </div>
            </div>
        </div>

        <!-- Info Boxes -->
        <div class="info-grid">
            <div class="info-box">
                <div class="info-title">☆ ONLINE USERS</div>
                <div class="info-content" id="online-count">Connecting...</div>
            </div>
            <div class="info-box">
                <div class="info-title">♪ STATUS</div>
                <div class="info-content">System: <span id="system-status">Stable*</span></div>
            </div>
            <div class="info-box">
                <div class="info-title">◆ LAST UPDATE</div>
                <div class="info-content">1999.11.08</div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="footer-divider">═══════════════════════════════════════</div>
            <div class="footer-copyright">© 1999 Patrick McDonald — The Before Us Universe</div>
            <div class="footer-note">Best viewed in 160x144 resolution</div>
            <div class="footer-divider">═══════════════════════════════════════</div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, push, onValue, set, onDisconnect } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBGdiOrMFolYWNMvckE4fbp_VhWA80BaII",
            authDomain: "before-us-universe.firebaseapp.com",
            databaseURL: "https://before-us-universe-default-rtdb.firebaseio.com",
            projectId: "before-us-universe",
            storageBucket: "before-us-universe.firebasestorage.app",
            messagingSenderId: "477103463228",
            appId: "1:477103463228:web:01b53b6b29cb9d54315c39"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        let currentUsername = localStorage.getItem('buu_username') || '';
        let userOnlineRef = null;

        // Boot sequence
        setTimeout(function() {
            document.getElementById('boot-screen').style.display = 'none';
            if (!currentUsername) {
                document.getElementById('username-modal').classList.add('show');
            } else {
                document.getElementById('main-content').classList.add('loaded');
                initializeUserApp();
            }
        }, 4000);

        // Set username
        window.setUsername = function() {
            const input = document.getElementById('username-input');
            const username = input.value.trim();
            if (username) {
                currentUsername = username;
                localStorage.setItem('buu_username', username);
                document.getElementById('username-modal').classList.remove('show');
                document.getElementById('main-content').classList.add('loaded');
                initializeUserApp();
            }
        };

        // Initialize user app features
        function initializeUserApp() {
            // Track online users
            const onlineUsersRef = ref(database, 'online/' + Date.now());
            set(onlineUsersRef, {
                username: currentUsername,
                timestamp: Date.now()
            });
            userOnlineRef = onlineUsersRef;
            onDisconnect(onlineUsersRef).remove();

            // Count online users
            const allOnlineRef = ref(database, 'online');
            onValue(allOnlineRef, (snapshot) => {
                const count = snapshot.size || 0;
                document.getElementById('online-count').textContent = 'Currently: ' + count;
            });

            // Load chat messages
            const chatRef = ref(database, 'chat');
            onValue(chatRef, (snapshot) => {
                const chatMessages = document.getElementById('chat-messages');
                chatMessages.innerHTML = '';
                snapshot.forEach((childSnapshot) => {
                    const msg = childSnapshot.val();
                    addChatMessage(msg.username, msg.text, msg.timestamp);
                });
                chatMessages.scrollTop = chatMessages.scrollHeight;
            });

            // Load board posts
            const postsRef = ref(database, 'posts');
            onValue(postsRef, (snapshot) => {
                const boardPosts = document.getElementById('board-posts');
                boardPosts.innerHTML = '';
                snapshot.forEach((childSnapshot) => {
                    const post = childSnapshot.val();
                    addBoardPost(post.title, post.content, post.username, post.timestamp);
                });
            });
        }

        // Send chat message
        window.sendMessage = function() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (message) {
                const chatRef = ref(database, 'chat');
                push(chatRef, {
                    username: currentUsername,
                    text: message,
                    timestamp: Date.now()
                });
                input.value = '';
            }
        };

        // Create board post
        window.createPost = function() {
            const titleInput = document.getElementById('post-title');
            const contentInput = document.getElementById('post-content');
            const title = titleInput.value.trim();
            const content = contentInput.value.trim();
            
            if (title && content) {
                const postsRef = ref(database, 'posts');
                push(postsRef, {
                    title: title,
                    content: content,
                    username: currentUsername,
                    timestamp: Date.now()
                });
                titleInput.value = '';
                contentInput.value = '';
            }
        };

        // Add chat message to DOM
        function addChatMessage(username, text, timestamp) {
            const chatMessages = document.getElementById('chat-messages');
            const time = new Date(timestamp).toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit', 
                hour12: false 
            });
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';
            messageDiv.innerHTML = 
                '<div class="chat-meta">[' + time + '] <span class="username">' + escapeHtml(username) + ':</span></div>' +
                '<div class="chat-text">' + escapeHtml(text) + '</div>';
            chatMessages.appendChild(messageDiv);
        }

        // Add board post to DOM
        function addBoardPost(title, content, username, timestamp) {
            const boardPosts = document.getElementById('board-posts');
            const date = new Date(timestamp).toLocaleDateString('en-US', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            }).replace(/\//g, '.');
            
            const postDiv = document.createElement('div');
            postDiv.className = 'board-post';
            postDiv.innerHTML = 
                '<div class="post-title">→ ' + escapeHtml(title) + '</div>' +
                '<div class="post-content">' + escapeHtml(content) + '</div>' +
                '<div class="post-meta">Posted by ' + escapeHtml(username) + ' | ' + date + '</div>';
            boardPosts.appendChild(postDiv);
        }

        // Enter key to send chat
        document.getElementById('chat-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Enter key to set username
        document.getElementById('username-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                setUsername();
            }
        });

        // Escape HTML
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }
    </script>
<script type="module" src="/before-us-universe/scripts/ntd-agent.js"></script>
</body>
</html>
