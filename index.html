<html lang="en">
<head>
<meta charset="utf-8">
<title>Before Us Universe — BUU</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23001a1a'/><path d='M20 25h60v10h-60zM20 45h60v10h-60zM20 65h60v10h-60z' fill='%2300ffff'/><circle cx='50' cy='50' r='8' fill='%23ffcc00'/></svg>" type="image/svg+xml">
<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div id="prebootOverlay">
<iframe id="prebootIframe" src="preboot.html"></iframe>
<div style="margin-top:10px; font-size:12px; color:var(--accent);">
[PRESS ANY KEY OR CLICK TO PROCEED TO BUU BOOT SEQUENCE]
</div>
</div>
<div id="marqueeWrap">
<div id="marqueeLabel">SYSTEM:</div>
<div id="marquee" aria-live="polite"><div id="marqueeInner">C:\\> Welcome to the Before Us Network — system: stable … MEMORY OK — DISK CHECK PASSED — NETWORK ACTIVE — AWAITING COMMAND… — — Site Under Construction —</div></div>
</div>
<div id="bootOverlay">
<div id="bootPanel">
<div id="bootLog" class="small"></div>
<div id="bootPrompt">> ENTER HANDLE & SELECT SERVER</div>
<div id="bootInputs">
<input id="bootInput" type="text" maxlength="30" placeholder="//YourHandle (required)" aria-label="Enter your handle">
<select id="bootChannel" aria-label="Select server">
<option value="sam">//Sam</option>
<option value="exuro">//Exuro</option>
<option value="nero">//Nero</option>
<option value="nora">//Nora</option>
<option value="loktal">//Loktal</option>
</select>
<button id="bootBtn" aria-label="Enter Network">ENTER NETWORK</button>
</div>
<div id="bootStatus" class="small" style="margin-top:8px;color:var(--accent)"></div>
<div id="bootBanner" class="small">System Broadcast: <span id="bootBroadcast">Timeline stability.. 84%</span></div>
</div>
</div>
<div id="app">
<div class="title-bar">
<div class="logo">C://BUU.exe</div>
<a class="link-btn" href="https://www.paypal.com/paypalme/pmcdon13" target="_blank" rel="noopener noreferrer">PayPal<span class="donate-flash">Donate</span></a>
<a class="link-btn" href="https://venmo.com/hisrobustness" target="_blank" rel="noopener noreferrer">Venmo<span class="donate-flash">Donate</span></a>
<a class="link-btn" href="https://tokillamockinggoblin.boards.net/" target="_blank" rel="noopener noreferrer" title="Join Sam's DND Realm">To Kill a Mocking Goblin</a>
<a class="link-btn" href="https://youtube.com/@Patrickauthor" target="_blank" rel="noopener noreferrer">Melphia’s YouTube</a>
<a class="link-btn" href="https://reedsy.com/discovery/book/before-us-1-melphia-s-game-patrick-mcdonald#preview" target="_blank" rel="noopener noreferrer" title="on reedsy">Read Sam's First Chapter</a>
<div class="controls-right">
</div>
</div>
<div style="text-align:center; margin:12px 0;">
<button id="buyBookBtn" style="background:var(--accent);color:#000;padding:10px;border:3px solid #000;cursor:pointer;font-weight:900;border-radius:6px;font-size:14px;display:inline-block;width:200px;margin:0 6px;">Buy book 1 now!</button>
<button id="stumbleBtn" style="background:var(--accent);color:#000;padding:10px;border:3px solid #000;cursor:pointer;font-weight:900;border-radius:6px;font-size:14px;display:inline-block;width:200px;margin:0 6px;">Stumble</button>
<button id="emailBtn" style="background:var(--accent);color:#000;padding:10px;border:3px solid #000;cursor:pointer;font-weight:900;border-radius:6px;font-size:14px;display:inline-block;width:200px;margin:0 6px;">Join Email List</button>
</div>
<div class="media-player">
    <div id="display">
        <marquee behavior="scroll" direction="left" scrollamount="3">No track playing</marquee>
    </div>
    <div class="progress-container">
        <div id="progress"></div>
    </div>
    <span class="time-display" id="current-time">0:00 / <span id="duration">0:00</span></span>
    <div class="controls">
        <button id="prev">&lt;&lt;</button>
        <button id="play">&gt;</button>
        <button id="pause">||</button>
        <button id="stop">[]</button>
        <button id="next">&gt;&gt;</button>
    </div>
    <audio id="audio-player"></audio>
</div>
<div class="layout">
<div>
<div class="panel" id="serverSelectPanel">
<div class="panel-title"><div class="title">//SERVER.SELECT</div></div>
<div class="panel-body">
<div id="systemFeed"></div>
<p style="color:var(--accent);font-weight:700">CURRENT SERVER: <span id="currentServerName">//sam</span></p>
<div class="controls">
<select id="serverSelect" aria-label="Select Server">
<option value="sam">//Sam</option>
<option value="exuro">//Exuro</option>
<option value="nero">//Nero</option>
<option value="nora">//Nora</option>
<option value="loktal">//Loktal</option>
</select>
<button id="serverConfirm">CONNECT</button>
</div>
</div>
</div>
<div class="panel">
<div class="chat-win">
<div class="chat-title">
<div class="title" id="chatTitle">//SAM: CHAT</div>
<div id="hitCounter">Hits: 0</div>
<button class="toggle-btn" aria-label="Toggle">▲</button>
</div>
<div class="chat-main" id="chatBody">
<div id="ortegaChatIframe" style="display: none;"></div>
<div class="chat-messages" id="messages">
<div class="chat-row">
<div class="chat-avatar" style="background:#ffcc00">S</div>
<div class="chat-bubble">
<div class="chat-meta">System @ 11:34 AM</div>
Welcome to the Before Us Universe. Type /help for commands.
</div>
</div>
</div>
<div class="chat-users" id="users">
<div class="user-row"><span class="status-dot" style="background:var(--online)"></span><span class="uname">System</span></div>
</div>
</div>
<div class="chat-controls">
<input type="text" id="chatInput" placeholder="Message or /command" aria-label="Chat message or command">
<button id="sendBtn">SEND</button>
</div>
</div>
</div>
<div class="panel collapsible">
<div class="panel-title"><div class="title">//BLOCKADERUNNER.exe</div><button class="fullscreen-btn" aria-label="Fullscreen">Fullscreen</button><button class="toggle-btn" aria-label="Toggle">▼</button></div>
<div class="panel-body" id="blockaderunnerBody" style="display:none;padding:0;">
<iframe src="blockaderunner.html" style="width:100%;height:600px;border:none;"></iframe>
</div>
</div>
<div class="panel collapsible">
<div class="panel-title"><div class="title">//LOAT.EXE (Life of a Technomancer)</div><button class="fullscreen-btn" aria-label="Fullscreen">Fullscreen</button><button class="toggle-btn" aria-label="Toggle">▼</button></div>
<div class="panel-body" id="loatBody" style="display:none;padding:0;">
<iframe src="symbiote.html" style="width:100%;height:600px;border:none;"></iframe>
</div>
</div>
<div class="panel collapsible">
<div class="panel-title"><div class="title">//WINDOS95</div><button class="fullscreen-btn" aria-label="Fullscreen">Fullscreen</button><button class="toggle-btn" aria-label="Toggle">▼</button></div>
<div class="panel-body" id="windos95Body" style="display:none;">
<p class="small">Access the legacy OS environment via Emupedia:</p>
<a href="https://emupedia.net/beta/emuos/win95/" target="_blank" rel="noopener noreferrer" class="link-btn">Launch Windows 95</a>
</div>
</div>
<div class="panel collapsible">
<div class="panel-title"><div class="title">//PLAYLIST.SAM</div><button class="toggle-btn" aria-label="Toggle">▼</button></div>
<div class="panel-body yt-wrap" id="ytBody" style="display:none;">
<iframe width="560" height="315" src="https://www.youtube.com/embed/videoseries?list=PLc1nF09D92pJCy_TQVOpfZg0BE-vAJJVq" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>
</div>
<div class="panel collapsible">
<div class="panel-title"><div class="title">//MINDGAME.exe</div><button class="toggle-btn" aria-label="Toggle">▼</button></div>
<div class="panel-body" id="mindgameBody" style="display:none;padding:0;">
<iframe src="mindgame.html" style="width:100%;height:600px;border:none;"></iframe>
</div>
</div>
<div class="panel collapsible">
<div class="panel-title"><div class="title">//shortstreams.youtube</div><button class="toggle-btn" aria-label="Toggle">▼</button></div>
<div class="panel-body" id="soraBody" style="display:none;">
<div id="shortstreams-wrap" class="yt-wrap">
<iframe width="560" height="315" src="https://www.youtube.com/embed/videoseries?list=PLDpwpKvok1S8ff8zQ9joe7wx3QrL977Wu" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>
</div>
</div>
<div class="panel collapsible">
<div class="panel-title"><div class="title">//fleetcommand.exe</div><button class="fullscreen-btn" aria-label="Fullscreen">Fullscreen</button><button class="toggle-btn" aria-label="Toggle">▼</button></div>
<div class="panel-body" id="fleetcommandBody" style="display:none;padding:0;">
<iframe src="fleet.html" style="width:100%;height:600px;border:none;"></iframe>
</div>
</div>
<div class="panel collapsible">
<div class="panel-title"><div class="title">//MessageBoard</div><button class="toggle-btn" aria-label="Toggle">▼</button></div>
<div class="panel-body" id="boardBody" style="display:none;">
<input type="text" id="boardSearch" placeholder="Search threads or post" aria-label="Search message board">
<div id="boardThreads">
<div class="board-thread">
<strong>System Announcement: Site Launch</strong>
<p>Welcome, users, to the newly restored Before Us Universe network. Please respect all rules and guidelines.</p>
<span class="small">Posted by Admin on 01/01/2025</span>
</div>
</div>
</div>
</div>
<div class="panel collapsible">
<div class="panel-title"><div class="title">//ENTITY.exe</div><button class="toggle-btn" aria-label="Toggle">▼</button></div>
<div class="panel-body" id="entityBody" style="display:none;padding:0;">
<iframe src="entity.html" style="width:100%;height:600px;border:none;"></iframe>
</div>
</div>
<div class="panel collapsible">
<div class="panel-title"><div class="title">//TACTICALCOMMAND.exe</div><button class="fullscreen-btn" aria-label="Fullscreen">Fullscreen</button><button class="toggle-btn" aria-label="Toggle">▼</button></div>
<div class="panel-body" id="tacticalBody" style="display:none;padding:0;">
<iframe src="tacticalcommand.html" style="width:100%;height:600px;border:none;"></iframe>
</div>
</div>
<div class="panel collapsible">
<div class="panel-title"><div class="title">//4219.exe (Under Construction)</div><button class="fullscreen-btn" aria-label="Fullscreen">Fullscreen</button><button class="toggle-btn" aria-label="Toggle">▼</button></div>
<div class="panel-body" id="exe4219Body" style="display:none;padding:0;">
<iframe src="4219.html" style="width:100%;height:600px;border:none;"></iframe>
</div>
</div>
<a href="https://google.com" target="_blank" rel="noopener noreferrer">
    <div class="ad-banner">Time Travel Cruise: See Dinosaurs!</div>
</a>
<div class="panel collapsible">
<div class="panel-title"><div class="title">//DISCORD</div><button class="toggle-btn" aria-label="Toggle">▼</button></div>
<div class="panel-body" id="discordBody" style="display:none;">
<p class="small">Join the community on Discord for real-time chatter:</p>
<a href="https://discord.gg/yourinvite" target="_blank" rel="noopener noreferrer" class="link-btn">Join Discord Channel</a>
</div>
</div>
<div class="panel collapsible">
<div class="panel-title"><div class="title">//GALLERIES</div><button class="toggle-btn" aria-label="Toggle">▼</button></div>
<div class="panel-body" id="galleriesPanel" style="display:none;padding:0;">
<iframe src="galleries.html" style="width:100%;height:600px;border:none;"></iframe>
</div>
</div>
<div class="panel collapsible">
<div class="panel-title"><div class="title">//REVIVAL.SITES</div><button class="toggle-btn" aria-label="Toggle">▼</button></div>
<div class="panel-body" id="revivalSitesPanel" style="display:none;">
<p class="small">Links to sites from the old web:</p>
<div class="link-row">
<a href="https://robustpvp-lang.github.io/robustpvp/robust.html" target="_blank" rel="noopener noreferrer" class="link-btn">Robust PVP</a>
<a href="https://web.archive.org/" target="_blank" rel="noopener noreferrer" class="link-btn">Wayback Machine</a>
<a href="https://www.oldversion.com/" target="_blank" rel="noopener noreferrer" class="link-btn">Old Version Downloads</a>
</div>
</div>
</div>
</div>
<div>
<div class="panel collapsible">
<div class="panel-title"><div class="title">//PROJECT.ORTEGA</div><button class="toggle-btn" aria-label="Toggle">▼</button></div>
<div class="panel-body" id="ortegaPanel" style="display:none;">
<button id="ortegaBtn">ACTIVATE PROJECT ORTEGA (0/18)</button>
<div id="ortegaIframeContainer">
<iframe id="ortegaIframe" src="ortega.html" style="width:100%;height:100%;border:none;"></iframe>
</div>
<p id="ortegaStatus" class="small" style="text-align:center;margin-top:10px;">Status: Inactive</p>
</div>
</div>
<div class="panel">
<div class="panel-title"><div class="title">//SERVER.TRACKING</div></div>
<div class="panel-body" id="serverTrackingPanel">
<p class="small" style="margin-bottom:12px;">Tracking online presence across the network.</p>
<div id="serverList">
<div class="server-branch current-server" data-server="sam">
<div class="server-title"><span class="status-icon animated">●</span> //Sam (1 User)</div>
<div class="user-list">
<div>System</div>
</div>
</div>
<div class="server-branch" data-server="exuro">
<div class="server-title"><span class="status-icon">○</span> //Exuro (0 Users)</div>
<div class="user-list"></div>
</div>
<div class="server-branch" data-server="nero">
<div class="server-title"><span class="status-icon">○</span> //Nero (0 Users)</div>
<div class="user-list"></div>
</div>
<div class="server-branch" data-server="nora">
<div class="server-title"><span class="status-icon">○</span> //Nora (0 Users)</div>
<div class="user-list"></div>
</div>
<div class="server-branch" data-server="loktal">
<div class="server-title"><span class="status-icon">○</span> //Loktal (0 Users)</div>
<div class="user-list"></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, push, serverTimestamp, set, get, update, runTransaction, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
import { getAuth, signInAnonymously, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
const firebaseConfig = {
apiKey: "...",
authDomain: "...",
projectId: "...",
storageBucket: "...",
messagingSenderId: "...",
appId: "...",
measurementId: "..."
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);
let currentChannel = 'sam';
let user = null;
let currentHandle = null;
let typingTimeout = null;
let isTyping = false;
let userListRef = null;
let isBooted = false;
const chatInput = document.getElementById('chatInput');
const sendBtn = document.getElementById('sendBtn');
const messagesDiv = document.getElementById('messages');
const usersDiv = document.getElementById('users');
const bootOverlay = document.getElementById('bootOverlay');
const appDiv = document.getElementById('app');
const bootInput = document.getElementById('bootInput');
const bootChannelSelect = document.getElementById('bootChannel');
const bootBtn = document.getElementById('bootBtn');
const bootLog = document.getElementById('bootLog');
const bootBroadcast = document.getElementById('bootBroadcast');
const chatTitle = document.getElementById('chatTitle');
const serverSelect = document.getElementById('serverSelect');
const serverConfirm = document.getElementById('serverConfirm');
const currentServerName = document.getElementById('currentServerName');
const ortegaBtn = document.getElementById('ortegaBtn');
const ortegaIframeContainer = document.getElementById('ortegaIframeContainer');
const ortegaChatIframe = document.getElementById('ortegaChatIframe');
const chatBody = document.getElementById('chatBody');
const mindgameBody = document.getElementById('mindgameBody');
const hitCounter = document.getElementById('hitCounter');
const prebootOverlay = document.getElementById('prebootOverlay');
const fullScreenButtons = document.querySelectorAll('.fullscreen-btn');
const collapsiblePanels = document.querySelectorAll('.panel.collapsible');
function logBoot(message, delay = 50) {
return new Promise(resolve => {
setTimeout(() => {
bootLog.innerHTML += message + '\n';
bootLog.scrollTop = bootLog.scrollHeight;
resolve();
}, delay);
});
}
async function bootSequence() {
document.getElementById('bootStatus').textContent = "Initializing...";
await logBoot("Starting BUU NetOS v4.2...", 100);
await logBoot("Verifying integrity...", 50);
await logBoot("Establishing secure connection to Firebase...", 150);
await logBoot("Checking network status...", 50);
await logBoot("Starting chat service...", 100);
document.getElementById('bootStatus').textContent = "Ready.";
bootOverlay.style.display = 'flex';
}
function enterNetwork(handle, channel) {
if (!handle) {
alert('Please enter a handle.');
return;
}
currentHandle = handle;
currentChannel = channel;
bootOverlay.style.display = 'none';
appDiv.style.display = 'block';
messagesDiv.innerHTML = `<div class="chat-row"><div class="chat-avatar" style="background:#ffcc00">S</div><div class="chat-bubble"><div class="chat-meta">System @ 11:34 AM</div>Welcome to the Before Us Universe. Type /help for commands.</div></div>`;
chatTitle.textContent = `//${currentChannel}: CHAT`;
currentServerName.textContent = `//${currentChannel}`;
serverSelect.value = currentChannel;
updateAuthProfile(handle).then(() => {
listenForMessages();
listenForUsers();
listenForHitCount();
});
}
function updateAuthProfile(handle) {
return updateProfile(auth.currentUser, {
displayName: handle
});
}
function getRandomColor(handle) {
let hash = 0;
if (handle.length === 0) return '#000000';
for (let i = 0; i < handle.length; i++) {
hash = handle.charCodeAt(i) + ((hash << 5) - hash);
}
let color = '#';
for (let i = 0; i < 3; i++) {
const value = (hash >> (i * 8)) & 0xFF;
color += ('00' + value.toString(16)).substr(-2);
}
return color;
}
function renderChatMessage(snapshot) {
const data = snapshot.val();
if (!data) return;
const time = new Date(data.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
const isMe = data.uid === user.uid;
const avatarBg = data.color || getRandomColor(data.handle);
const messageHtml = `
<div class="chat-row" style="${isMe ? 'justify-content: flex-end;' : 'justify-content: flex-start;'}">
<div class="chat-avatar" style="background:${avatarBg}; order:${isMe ? 2 : 1}">${data.handle.charAt(0)}</div>
<div class="chat-bubble ${isMe ? 'me' : ''}" style="order:${isMe ? 1 : 2};">
<div class="chat-meta">${data.handle} @ ${time}</div>
${data.text}
</div>
</div>
`;
messagesDiv.innerHTML += messageHtml;
messagesDiv.scrollTop = messagesDiv.scrollHeight;
}
function postMessage(text) {
if (!text.trim()) return;
if (text.startsWith('/')) {
handleCommand(text);
return;
}
if (ortegaChatIframe.style.display === 'block') {
if (text.toLowerCase() === '/exit') {
exitOrtegaChat();
return;
}
ortegaIframe.contentWindow.postMessage({ type: 'userMessage', message: text }, '*');
chatInput.value = '';
return;
}
if (mindgameBody.querySelector('iframe').src.includes('mindgame_chat.html')) {
if (text.toLowerCase() === '/exit') {
mindgameBody.querySelector('iframe').src = 'mindgame.html';
mindgameBody.style.display = 'none';
document.querySelector('#mindgameBody').closest('.panel.collapsible').classList.add('collapsed');
chatInput.value = '';
return;
}
}
const chatRef = ref(db, `messages/${currentChannel}`);
push(chatRef, {
handle: currentHandle,
text: text,
timestamp: serverTimestamp(),
uid: user.uid,
color: getRandomColor(currentHandle)
}).then(() => {
chatInput.value = '';
});
}
function handleCommand(command) {
const parts = command.trim().split(/\s+/);
const cmd = parts[0].toLowerCase();
const args = parts.slice(1);
const msgRef = ref(db, `messages/${currentChannel}`);
const sysHandle = 'System [AI]';
switch(cmd) {
case '/help':
push(msgRef, {
handle: sysHandle,
text: "Commands: /d20, /d6 [count], /server [name], /operationcwal, /motherlode, /who, /exit (in chat modes).",
timestamp: serverTimestamp(),
uid: 'system'
});
break;
case '/d20':
const roll20 = Math.floor(Math.random() * 20) + 1;
push(msgRef, {
handle: sysHandle,
text: `${currentHandle} rolled a D20 and got: ${roll20}.`,
timestamp: serverTimestamp(),
uid: 'system'
});
break;
case '/d6':
let count = parseInt(args[0]) || 1;
count = Math.min(count, 5);
const rolls = Array.from({length: count}, () => Math.floor(Math.random() * 6) + 1);
const total = rolls.reduce((a, b) => a + b, 0);
push(msgRef, {
handle: sysHandle,
text: `${currentHandle} rolled ${count} D6 dice: [${rolls.join(', ')}], Total: ${total}.`,
timestamp: serverTimestamp(),
uid: 'system'
});
break;
case '/server':
const newChannel = args[0] ? args[0].toLowerCase() : null;
if (newChannel && ['sam', 'exuro', 'nero', 'nora', 'loktal'].includes(newChannel)) {
changeServer(newChannel);
} else {
push(msgRef, {
handle: sysHandle,
text: "Invalid server name. Options: sam, exuro, nero, nora, loktal.",
timestamp: serverTimestamp(),
uid: 'system'
});
}
break;
case '/operationcwal':
enterOrtegaChat();
break;
case '/motherlode':
enterMindGameChat();
break;
case '/who':
const onlineUsers = Array.from(usersDiv.querySelectorAll('.uname')).map(el => el.textContent);
push(msgRef, {
handle: sysHandle,
text: `Online Users in ${currentChannel.toUpperCase()}: ${onlineUsers.join(', ')}`,
timestamp: serverTimestamp(),
uid: 'system'
});
break;
default:
push(msgRef, {
handle: sysHandle,
text: `Unknown command: ${cmd}. Type /help for a list of commands.`,
timestamp: serverTimestamp(),
uid: 'system'
});
}
chatInput.value = '';
}
function changeServer(newChannel) {
if (newChannel === currentChannel) return;
// 1. Remove user from old channel
removeUserFromChannel(currentChannel, user.uid);
// 2. Update channel variable
currentChannel = newChannel;
// 3. Update UI
chatTitle.textContent = `//${currentChannel}: CHAT`;
currentServerName.textContent = `//${currentChannel}`;
serverSelect.value = currentChannel;
// 4. Clear old messages/users
messagesDiv.innerHTML = '';
usersDiv.innerHTML = '';
// 5. Start listening for new channel
listenForMessages();
listenForUsers();
// 6. Add user to new channel
addUserToChannel(currentChannel, user.uid, currentHandle);
// 7. Post system message
const msgRef = ref(db, `messages/${currentChannel}`);
push(msgRef, {
handle: 'System',
text: `${currentHandle} has joined ${currentChannel.toUpperCase()}.`,
timestamp: serverTimestamp(),
uid: 'system'
});
}
function listenForMessages() {
const chatRef = query(ref(db, `messages/${currentChannel}`), orderByChild('timestamp'));
onValue(chatRef, (snapshot) => {
messagesDiv.innerHTML = ''; // Clear only when the channel changes fully
snapshot.forEach(renderChatMessage);
messagesDiv.scrollTop = messagesDiv.scrollHeight;
});
}
function listenForUsers() {
if (userListRef) {
onValue(userListRef, () => {}); // Detach old listener
}
userListRef = ref(db, `users/${currentChannel}`);
onValue(userListRef, (snapshot) => {
usersDiv.innerHTML = '';
let userCount = 0;
snapshot.forEach(childSnapshot => {
const userData = childSnapshot.val();
if (userData.handle) {
const isTypingIndicator = userData.isTyping ? '<span> (typing...)</span>' : '';
const userRowHtml = `
<div class="user-row" data-uid="${userData.uid}">
<span class="status-dot" style="background:${userData.isTyping ? 'var(--accent)' : 'var(--online)'}"></span>
<span class="uname">${userData.handle}</span>${isTypingIndicator}
</div>
`;
usersDiv.innerHTML += userRowHtml;
userCount++;
}
});
// Update server tracking panel dynamically
const allServersRef = ref(db, 'users');
onValue(allServersRef, (allServersSnapshot) => {
const serverListDiv = document.getElementById('serverList');
serverListDiv.innerHTML = '';
const serverData = { sam: [], exuro: [], nero: [], nora: [], loktal: [] };
allServersSnapshot.forEach(serverSnapshot => {
const serverName = serverSnapshot.key;
serverSnapshot.forEach(userSnapshot => {
const userData = userSnapshot.val();
if (userData.handle) {
serverData[serverName].push(userData.handle);
}
});
});
Object.keys(serverData).forEach(serverName => {
const userListHtml = serverData[serverName].map(handle => `<div>${handle}</div>`).join('');
const isCurrent = serverName === currentChannel ? 'current-server' : '';
const statusIcon = serverData[serverName].length > 0 ? `<span class="status-icon ${serverData[serverName].length > 0 ? 'animated' : ''}">●</span>` : `<span class="status-icon">○</span>`;
const serverHtml = `
<div class="server-branch ${isCurrent}" data-server="${serverName}">
<div class="server-title">${statusIcon} //${serverName} (${serverData[serverName].length} ${serverData[serverName].length === 1 ? 'User' : 'Users'})</div>
<div class="user-list" style="${isCurrent ? 'display:block;' : 'display:none;'}">${userListHtml}</div>
</div>
`;
serverListDiv.innerHTML += serverHtml;
});
// Reattach listeners to server titles for toggling
document.querySelectorAll('.server-title').forEach(title => {
title.onclick = function() {
const userList = this.nextElementSibling;
if (userList.style.display === 'none') {
userList.style.display = 'block';
} else {
userList.style.display = 'none';
}
};
});
});
});
}
function addUserToChannel(channel, uid, handle) {
const userRef = ref(db, `users/${channel}/${uid}`);
set(userRef, {
handle: handle,
uid: uid,
isTyping: false
});
// Set presence on disconnect
if (user) {
const presenceRef = ref(db, `users/${channel}/${uid}`);
onValue(ref(db, '.info/connected'), (snapshot) => {
if (snapshot.val() === true) {
set(presenceRef, {
handle: handle,
uid: uid,
isTyping: false
}).then(() => {
update(presenceRef, {
lastSeen: serverTimestamp()
});
});
onDisconnect(presenceRef).remove();
}
});
}
}
function removeUserFromChannel(channel, uid) {
const userRef = ref(db, `users/${channel}/${uid}`);
set(userRef, null);
}
function updateTypingStatus(isTyping) {
if (!user) return;
const userRef = ref(db, `users/${currentChannel}/${user.uid}`);
update(userRef, { isTyping: isTyping });
}
function listenForHitCount() {
const hitsRef = ref(db, 'hitCount');
onValue(hitsRef, (snapshot) => {
hitCounter.textContent = `Hits: ${snapshot.val() || 0}`;
});
}
function incrementHitCount() {
const hitsRef = ref(db, 'hitCount');
runTransaction(hitsRef, (currentValue) => {
return (currentValue || 0) + 1;
});
}
function enterOrtegaChat() {
const ortegaPanel = document.getElementById('ortegaPanel').closest('.panel.collapsible');
if (ortegaPanel.classList.contains('collapsed')) {
ortegaPanel.querySelector('.toggle-btn').click();
}
ortegaChatIframe.style.display = 'block';
ortegaIframeContainer.style.display = 'block'; // Ensure the iframe is visible in its own panel
ortegaIframeContainer.querySelector('iframe').src = ortegaIframeContainer.querySelector('iframe').src; // Reloads the iframe
chatInput.placeholder = "Message Ortega or type /exit";
const msgRef = ref(db, `messages/${currentChannel}`);
push(msgRef, {
handle: 'System',
text: `${currentHandle} initiated Project Ortega. Type /exit to leave the command shell.`,
timestamp: serverTimestamp(),
uid: 'system'
});
}
function exitOrtegaChat() {
ortegaChatIframe.style.display = 'none';
chatInput.placeholder = "Message or /command";
// Hide the iframe in the Ortega panel if it was opened via the chat
document.getElementById('ortegaIframeContainer').style.display = 'none';
const msgRef = ref(db, `messages/${currentChannel}`);
push(msgRef, {
handle: 'System',
text: `${currentHandle} disconnected from Project Ortega.`,
timestamp: serverTimestamp(),
uid: 'system'
});
}
function enterMindGameChat() {
const mindgamePanel = document.getElementById('mindgameBody').closest('.panel.collapsible');
mindgamePanel.classList.remove('collapsed');
mindgameBody.style.display = 'block';
mindgameBody.querySelector('iframe').src = 'mindgame_chat.html';
chatInput.placeholder = "Message MindGame or type /exit";
const msgRef = ref(db, `messages/${currentChannel}`);
push(msgRef, {
handle: 'System',
text: `${currentHandle} initiated MindGame chat. Type /exit to quit.`,
timestamp: serverTimestamp(),
uid: 'system'
});
}
window.onload = function() {
bootSequence();
document.addEventListener('keydown', function handler(e) {
if (prebootOverlay.style.display !== 'none') {
prebootOverlay.style.display = 'none';
bootOverlay.style.display = 'flex';
document.removeEventListener('keydown', handler);
}
});
document.addEventListener('click', function handler(e) {
if (prebootOverlay.style.display !== 'none') {
prebootOverlay.style.display = 'none';
bootOverlay.style.display = 'flex';
document.removeEventListener('click', handler);
}
});
};
signInAnonymously(auth).then((userCredential) => {
user = userCredential.user;
if (user) {
// The initial network entry is handled by the user pressing the button
}
}).catch((error) => {
console.error("Authentication failed:", error);
bootLog.innerHTML += `<span style="color:red;">ERROR: Auth failed: ${error.message}</span>\n`;
});
// Event Listeners
bootBtn.onclick = () => {
incrementHitCount();
const handle = bootInput.value.trim();
const channel = bootChannelSelect.value;
enterNetwork(handle, channel);
};
chatInput.addEventListener('keydown', (e) => {
if (e.key === 'Enter') {
postMessage(chatInput.value);
}
if (!isTyping) {
isTyping = true;
updateTypingStatus(true);
}
clearTimeout(typingTimeout);
typingTimeout = setTimeout(() => {
isTyping = false;
updateTypingStatus(false);
}, 3000);
});
sendBtn.onclick = () => postMessage(chatInput.value);
serverConfirm.onclick = () => changeServer(serverSelect.value);
collapsiblePanels.forEach(panel => {
const toggleBtn = panel.querySelector('.toggle-btn');
toggleBtn.onclick = function() {
panel.classList.toggle('collapsed');
this.textContent = panel.classList.contains('collapsed') ? '▼' : '▲';
};
panel.querySelector('.panel-title').onclick = function(e) {
if (e.target.tagName !== 'BUTTON' && e.target.closest('button') === null) {
toggleBtn.click();
}
};
});
let ortegaClickCount = 0;
ortegaBtn.onclick = () => {
ortegaClickCount++;
ortegaBtn.textContent = `ACTIVATE PROJECT ORTEGA (${ortegaClickCount}/18)`;
if (ortegaClickCount >= 18) {
ortegaIframeContainer.style.display = 'block';
document.getElementById('ortegaStatus').textContent = 'Status: Active';
ortegaBtn.disabled = true;
// Reload iframe to ensure fresh load
ortegaIframeContainer.querySelector('iframe').src = ortegaIframeContainer.querySelector('iframe').src;
setTimeout(() => {
ortegaClickCount = 0;
ortegaBtn.textContent = 'ACTIVATE PROJECT ORTEGA (0/18)';
ortegaBtn.disabled = false;
}, 60000);
}
};
fullScreenButtons.forEach(btn => {
const panel = btn.closest('.panel');
const panelBody = panel.querySelector('.panel-body');
const updateButton = () => {
btn.textContent = document.fullscreenElement === panelBody ? 'Exit Fullscreen' : 'Fullscreen';
};
updateButton();
panel.addEventListener('fullscreenchange', updateButton);
btn.onclick = () => {
if (document.fullscreenElement === panelBody) {
document.exitFullscreen();
} else {
panelBody.requestFullscreen().catch(err => {
alert(`Error attempting to enable full-screen mode: ${err.message}`);
});
}
};
});
document.getElementById('stumbleBtn').onclick = () => {
const revivalLinks = Array.from(document.querySelectorAll('#revivalSitesPanel .panel-body a'))
.map(a => a.href)
.filter(href => href.startsWith('http') && !href.includes('discord.gg') && !href.includes('en.wikipedia.org') && !href.includes('x.com') && !href.includes('robustpvp-lang.github.io'));
const toolbarLinks = [
'https://tokillamockinggoblin.boards.net/',
'https://youtube.com/@Patrickauthor',
'https://reedsy.com/discovery/book/before-us-1-melphia-s-game-patrick-mcdonald#preview',
'https://spacehey.com/profile?id=4317004',
'https://web.archive.org/',
'https://www.oldversion.com/'
];
revivalLinks.push(...toolbarLinks);
const randomLink = revivalLinks[Math.floor(Math.random() * revivalLinks.length)];
const timestamp = Date.now();
window.open(`${randomLink}?t=${timestamp}`, '_blank');
};
document.getElementById('emailBtn').onclick = () => {
window.open('https://forms.gle/LBAkMsnVT7xrraYT8', '_blank');
};
document.getElementById('buyBookBtn').onclick = () => {
window.open('bookpage.html', '_blank');
};
// Media Player Logic
const audio = document.getElementById('audio-player');
const playBtn = document.getElementById('play');
const pauseBtn = document.getElementById('pause');
const stopBtn = document.getElementById('stop');
const prevBtn = document.getElementById('prev');
const nextBtn = document.getElementById('next');
const displayMarquee = document.querySelector('.media-player #display marquee');
const progressDiv = document.getElementById('progress');
const currentTimeSpan = document.getElementById('current-time');
const durationSpan = document.getElementById('duration');
const playlist = [
{ title: "BUU Theme - Orbital Echo", src: "https://robustpvp-lang.github.io/robustpvp/audio/orbital_echo.mp3" },
{ title: "BUU Theme - Cyber Pulse", src: "https://robustpvp-lang.github.io/robustpvp/audio/cyber_pulse.mp3" },
{ title: "Melphia's Tune - Synthetic Dream", src: "https://robustpvp-lang.github.io/robustpvp/audio/synthetic_dream.mp3" }
];
let currentTrackIndex = 0;
let isPlaying = false;
function formatTime(seconds) {
const minutes = Math.floor(seconds / 60);
const secs = Math.floor(seconds % 60);
return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
}
function loadTrack(index) {
currentTrackIndex = index;
audio.src = playlist[currentTrackIndex].src;
displayMarquee.textContent = `Now Playing: ${playlist[currentTrackIndex].title}`;
// Update duration once metadata is loaded
audio.onloadedmetadata = () => {
durationSpan.textContent = formatTime(audio.duration);
};
// Ensure player stops if track fails to load
audio.onerror = () => {
displayMarquee.textContent = `Error loading track: ${playlist[currentTrackIndex].title}`;
stopTrack();
};
}
function playTrack() {
if (!isPlaying) {
audio.play();
isPlaying = true;
playBtn.textContent = '||'; // Change to a pause symbol
}
}
function pauseTrack() {
if (isPlaying) {
audio.pause();
isPlaying = false;
playBtn.textContent = '▶';
}
}
function stopTrack() {
audio.pause();
audio.currentTime = 0;
progressDiv.style.width = '0%';
isPlaying = false;
playBtn.textContent = '▶';
displayMarquee.textContent = `Stopped: ${playlist[currentTrackIndex].title}`;
currentTimeSpan.textContent = '0:00';
}
function nextTrack() {
currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
loadTrack(currentTrackIndex);
playTrack();
}
function prevTrack() {
currentTrackIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
loadTrack(currentTrackIndex);
playTrack();
}
// Initial load
loadTrack(currentTrackIndex);
// Player Event Handlers
playBtn.addEventListener('click', () => {
if (audio.paused) {
playTrack();
} else {
pauseTrack();
}
});
pauseBtn.addEventListener('click', pauseTrack);
stopBtn.addEventListener('click', stopTrack);
nextBtn.addEventListener('click', nextTrack);
prevBtn.addEventListener('click', prevTrack);
audio.addEventListener('timeupdate', () => {
const progress = (audio.currentTime / audio.duration) * 100;
progressDiv.style.width = `${progress}%`;
currentTimeSpan.textContent = formatTime(audio.currentTime);
});
audio.addEventListener('ended', nextTrack);
    // Add this to index.html to catch the boot signal
window.addEventListener('message', function(e) {
    if (e.data === 'triggerBoot') {
        const prebootOverlay = document.getElementById('prebootOverlay');
        const bootOverlay = document.getElementById('bootOverlay');
        
        if (prebootOverlay && prebootOverlay.style.display !== 'none') {
            prebootOverlay.style.display = 'none';
            bootOverlay.style.display = 'flex';
        }
    }
});
</script>
</body>
</html>
